(window.webpackJsonp=window.webpackJsonp||[]).push([[247],{604:function(t,a,_){"use strict";_.r(a);var v=_(20),s=Object(v.a)({},(function(){var t=this,a=t.$createElement,_=t._self._c||a;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("h1",{attrs:{id:"feed流"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#feed流"}},[t._v("#")]),t._v(" feed流")]),t._v(" "),_("h2",{attrs:{id:"简介"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),_("p",[t._v("feed 的本意是饲料, feed 流本意就是有人一直往一个地方投递新鲜的饲料.如果需要饲料,只需要盯着投递点就可以了.不停的更新信息单元,只要关注某些发布者就能获取源源不断的新鲜信息.")]),t._v(" "),_("h2",{attrs:{id:"系统特点"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#系统特点"}},[t._v("#")]),t._v(" 系统特点")]),t._v(" "),_("p",[t._v("将 N 个发布者信息单元通过关注关系传递给 M 个接收者.")]),t._v(" "),_("h3",{attrs:{id:"关系"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#关系"}},[t._v("#")]),t._v(" 关系")]),t._v(" "),_("ol",[_("li",[t._v("发布者数据 : 生产数据")]),t._v(" "),_("li",[t._v("关注关系 : 微博中的关注是单向流,朋友圈是好友,是双向流,不管是单向还是双向,发布者发布一条信息信息的流动永远是单向的.")]),t._v(" "),_("li",[t._v("接收者数据 : 从不同的发布者那里获取数据,然后通过某种顺序(一般是时间)组织在一起.数据具有时间热度性,越新的数据越有价值,越新的数据就要排在最前面")])]),t._v(" "),_("h3",{attrs:{id:"相关表"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#相关表"}},[t._v("#")]),t._v(" 相关表")]),t._v(" "),_("ol",[_("li",[t._v("存储库 : 存储发布者数据,永久保存")]),t._v(" "),_("li",[t._v("关注表 : 用户关系表,永久保存")]),t._v(" "),_("li",[t._v("同步库 : 存储接收者的时间热度数据,只需要保留最近一段时间的数据即可")])]),t._v(" "),_("h2",{attrs:{id:"系统设计"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#系统设计"}},[t._v("#")]),t._v(" 系统设计")]),t._v(" "),_("h3",{attrs:{id:"产品定义"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#产品定义"}},[t._v("#")]),t._v(" 产品定义")]),t._v(" "),_("h4",{attrs:{id:"常见类型"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#常见类型"}},[t._v("#")]),t._v(" 常见类型")]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("类型")]),t._v(" "),_("th",[t._v("关注关系")]),t._v(" "),_("th",[t._v("是否有大 v")]),t._v(" "),_("th",[t._v("时效性")]),t._v(" "),_("th",[t._v("排序")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("微博")]),t._v(" "),_("td",[t._v("单向")]),t._v(" "),_("td",[t._v("有")]),t._v(" "),_("td",[t._v("秒,分")]),t._v(" "),_("td",[t._v("时间")])]),t._v(" "),_("tr",[_("td",[t._v("抖音")]),t._v(" "),_("td",[t._v("单向/无")]),t._v(" "),_("td",[t._v("有")]),t._v(" "),_("td",[t._v("秒,分")]),t._v(" "),_("td",[t._v("推荐")])]),t._v(" "),_("tr",[_("td",[t._v("朋友圈")]),t._v(" "),_("td",[t._v("双向")]),t._v(" "),_("td",[t._v("无")]),t._v(" "),_("td",[t._v("秒")]),t._v(" "),_("td",[t._v("时间")])]),t._v(" "),_("tr",[_("td",[t._v("私信")]),t._v(" "),_("td",[t._v("双向")]),t._v(" "),_("td",[t._v("无")]),t._v(" "),_("td",[t._v("秒")]),t._v(" "),_("td",[t._v("时间")])])])]),t._v(" "),_("ul",[_("li",[t._v("关注关系是单向还是双向 : 如果是单向可能存在大 v 现象,如果是双向,就是好友,好友数量有限,不坑你会有大 v.")]),t._v(" "),_("li",[t._v("排序是时间还是推荐 : 用户最容易接受的是时间,推荐相当于关注了全网用户.")])]),t._v(" "),_("h3",{attrs:{id:"存储"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#存储"}},[t._v("#")]),t._v(" 存储")]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("主键列")]),t._v(" "),_("th",[t._v("第一列主键")]),t._v(" "),_("th",[t._v("第二列主键")]),t._v(" "),_("th",[t._v("属性列")]),t._v(" "),_("th",[t._v("属性列")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("列名")]),t._v(" "),_("td",[t._v("user_id")]),t._v(" "),_("td",[t._v("message_id")]),t._v(" "),_("td",[t._v("content")]),t._v(" "),_("td",[t._v("other")])]),t._v(" "),_("tr",[_("td",[t._v("解释")]),t._v(" "),_("td",[t._v("消息发送者用户 ID")]),t._v(" "),_("td",[t._v("消息顺序 ID,可以使用 timestamp")]),t._v(" "),_("td",[t._v("内容")]),t._v(" "),_("td",[t._v("其它内容")])])])]),t._v(" "),_("h3",{attrs:{id:"同步"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#同步"}},[t._v("#")]),t._v(" 同步")]),t._v(" "),_("ul",[_("li",[t._v("推模式 : 即写扩散,发送者发送一个消息后立即将这个消息推送给接收者,单接收者不一定在线,那么就需要存储这些数据,这个存储的地方就是同步库,一个消息需要发送给多个粉丝,消息会复制多份,对同步库要求写入能力强和稳定,读取的时候消息已经发送到接收者信箱只需要读取一次收件箱就可以.")]),t._v(" "),_("li",[t._v("拉模式 : 即读扩散,发送者发出一条消息,不会立即推送给粉丝,而是写入自己的发件箱,当粉丝上线后自己去关注者发件箱去读取,一条消息的写入只有一次")]),t._v(" "),_("li",[t._v("推拉结合")])]),t._v(" "),_("h3",{attrs:{id:"用户详情和列表"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#用户详情和列表"}},[t._v("#")]),t._v(" 用户详情和列表")]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("主键顺序")]),t._v(" "),_("th",[t._v("第一列主键")]),t._v(" "),_("th",[t._v("属性列1")]),t._v(" "),_("th",[t._v("属性列2")]),t._v(" "),_("th",[t._v("...")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("字段名")]),t._v(" "),_("td",[t._v("user_id")]),t._v(" "),_("td",[t._v("nick_name")]),t._v(" "),_("td",[t._v("gender")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("备注")]),t._v(" "),_("td",[t._v("主键列,唯一用户")]),t._v(" "),_("td",[t._v("昵称")]),t._v(" "),_("td",[t._v("性别")]),t._v(" "),_("td")])])]),t._v(" "),_("h2",{attrs:{id:"拉取模式-读扩散"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#拉取模式-读扩散"}},[t._v("#")]),t._v(" 拉取模式--读扩散")]),t._v(" "),_("h3",{attrs:{id:"关注存储"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#关注存储"}},[t._v("#")]),t._v(" 关注存储")]),t._v(" "),_("h3",{attrs:{id:"粉丝存储"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#粉丝存储"}},[t._v("#")]),t._v(" 粉丝存储")]),t._v(" "),_("h3",{attrs:{id:"发布存储"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#发布存储"}},[t._v("#")]),t._v(" 发布存储")]),t._v(" "),_("h3",{attrs:{id:"接受存储"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#接受存储"}},[t._v("#")]),t._v(" 接受存储")]),t._v(" "),_("p",[t._v("不需要接受存储")]),t._v(" "),_("ol",[_("li",[t._v("获取关注列表")]),t._v(" "),_("li",[t._v("获取所关注用户发布的feed")]),t._v(" "),_("li",[t._v("对feed消息进行排序、分页")])]),t._v(" "),_("h3",{attrs:{id:"关注"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#关注"}},[t._v("#")]),t._v(" 关注")]),t._v(" "),_("h3",{attrs:{id:"取消关注"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#取消关注"}},[t._v("#")]),t._v(" 取消关注")]),t._v(" "),_("h3",{attrs:{id:"优缺点"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#优缺点"}},[t._v("#")]),t._v(" 优缺点")]),t._v(" "),_("p",[t._v("feed存储一份,存储小,性能差")]),t._v(" "),_("h2",{attrs:{id:"推送模式-写扩散"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#推送模式-写扩散"}},[t._v("#")]),t._v(" 推送模式--写扩散")]),t._v(" "),_("h3",{attrs:{id:"关注存储-2"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#关注存储-2"}},[t._v("#")]),t._v(" 关注存储")]),t._v(" "),_("h3",{attrs:{id:"粉丝存储-2"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#粉丝存储-2"}},[t._v("#")]),t._v(" 粉丝存储")]),t._v(" "),_("h3",{attrs:{id:"发布存储-2"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#发布存储-2"}},[t._v("#")]),t._v(" 发布存储")]),t._v(" "),_("h3",{attrs:{id:"接受存储-2"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#接受存储-2"}},[t._v("#")]),t._v(" 接受存储")]),t._v(" "),_("h3",{attrs:{id:"关注-2"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#关注-2"}},[t._v("#")]),t._v(" 关注")]),t._v(" "),_("h3",{attrs:{id:"取消关注-2"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#取消关注-2"}},[t._v("#")]),t._v(" 取消关注")]),t._v(" "),_("h3",{attrs:{id:"优缺点-2"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#优缺点-2"}},[t._v("#")]),t._v(" 优缺点")]),t._v(" "),_("p",[t._v("feed存储多分,用冗余存储换锁冲突,性能高")]),t._v(" "),_("p",[t._v("减少锁冲突")]),t._v(" "),_("ol",[_("li",[t._v("取消关注是要接收存储中删除消息")])]),t._v(" "),_("h2",{attrs:{id:"推拉结合"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#推拉结合"}},[t._v("#")]),t._v(" 推拉结合")]),t._v(" "),_("p",[t._v("大v和普通用户分离")]),t._v(" "),_("h2",{attrs:{id:"好友中心"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#好友中心"}},[t._v("#")]),t._v(" 好友中心")]),t._v(" "),_("ol",[_("li",[t._v("弱好友关系 : 不需要双方同意就可以建立好友关系,例如关注和粉丝")]),t._v(" "),_("li",[t._v("强好友关系 : 需要彼此同意才能建立好友关系.如 QQ、微信等")])]),t._v(" "),_("div",{staticClass:"language-shell line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-shell"}},[_("code",[_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 弱好友关系")]),t._v("\nguanzhu"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uid, guanzhu_uid"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 记录 uid 所有关注用户 guanzhu_uid")]),t._v("\nfensi"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uid, fensi_uid"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 记录 uid 所有粉丝用户 fensi_uid")]),t._v("\n"),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 强好友关系")]),t._v("\nfriend"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uid1, uid2"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[t._v("1")]),_("br"),_("span",{staticClass:"line-number"},[t._v("2")]),_("br"),_("span",{staticClass:"line-number"},[t._v("3")]),_("br"),_("span",{staticClass:"line-number"},[t._v("4")]),_("br"),_("span",{staticClass:"line-number"},[t._v("5")]),_("br")])])])}),[],!1,null,null,null);a.default=s.exports}}]);