(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{398:function(t,s,a){t.exports=a.p+"assets/img/go-tool-pprof-index.cd6153c2.png"},399:function(t,s,a){t.exports=a.p+"assets/img/go-tool-pprof-view.fc46a522.png"},593:function(t,s,a){"use strict";a.r(s);var n=a(20),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"pprof-实战"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pprof-实战"}},[t._v("#")]),t._v(" pprof 实战")]),t._v(" "),n("h2",{attrs:{id:"采样方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#采样方式"}},[t._v("#")]),t._v(" 采样方式")]),t._v(" "),n("ol",[n("li",[t._v("runtime/pprof")]),t._v(" "),n("li",[t._v("net/http/pprof")]),t._v(" "),n("li",[t._v("go test")])]),t._v(" "),n("h2",{attrs:{id:"使用模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用模式"}},[t._v("#")]),t._v(" 使用模式")]),t._v(" "),n("ol",[n("li",[t._v("报告生成")]),t._v(" "),n("li",[t._v("交互终端")]),t._v(" "),n("li",[t._v("web 界面")])]),t._v(" "),n("h2",{attrs:{id:"用途"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#用途"}},[t._v("#")]),t._v(" 用途")]),t._v(" "),n("ol",[n("li",[t._v("cpu profiling : cpu 分析,按照一定频率采集监听的应用程序的 cpu 使用情况可确定应用程序主动消耗 cpu 周期时花费时间的位置")]),t._v(" "),n("li",[t._v("memory profiling : 内存分析,在应用程序进行堆分配时记录堆栈跟踪,用于监视当前和历史内存使用情况及检查内存泄漏")]),t._v(" "),n("li",[t._v("block profiling : 阻塞分析,记录 goroutine 阻塞等待同步位置,默认不开启,需要调用 runtime.SetBlockProfileRate 进行设置")]),t._v(" "),n("li",[t._v("mutex profiling : 互斥锁分析,报告互斥锁竞争情况,默认不开启,需要调用 runtime.SetMutexProfileFraction 进行设置")]),t._v(" "),n("li",[t._v("goroutine profiling : Goroutine 分析,对正在运行的 Goroutine 进行堆栈跟踪和分析")])]),t._v(" "),n("h2",{attrs:{id:"示例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[t._v("#")]),t._v(" 示例")]),t._v(" "),n("div",{staticClass:"language-go line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" datas "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("go")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\tfmt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello world"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\ttime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Sleep")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Millisecond "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ListenAndServe")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0:6060"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("str "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tdata "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("byte")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("str"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tdatas "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("datas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("len")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("datas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br")])]),n("h2",{attrs:{id:"通过浏览器访问"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#通过浏览器访问"}},[t._v("#")]),t._v(" 通过浏览器访问")]),t._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("http://localhost:6060/debug/pprof/\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("p",[n("img",{attrs:{src:a(398),alt:"go-pprof"}})]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("名称")]),t._v(" "),n("th",[t._v("备注")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("allocs")]),t._v(" "),n("td",[t._v("查看过去所有内存分配样本")])]),t._v(" "),n("tr",[n("td",[t._v("block")]),t._v(" "),n("td",[t._v("查看导致同步阻塞的堆栈跟踪")])]),t._v(" "),n("tr",[n("td",[t._v("cmdline")]),t._v(" "),n("td",[t._v("当前程序的命令行完整调用路径")])]),t._v(" "),n("tr",[n("td",[t._v("goroutine")]),t._v(" "),n("td",[t._v("查看当前所有运行的 goroutine 堆栈跟踪")])]),t._v(" "),n("tr",[n("td",[t._v("heap")]),t._v(" "),n("td",[t._v("查看活动对象的内存分配情况")])]),t._v(" "),n("tr",[n("td",[t._v("mutex")]),t._v(" "),n("td",[t._v("查看导致互斥锁的竞争持有者的堆栈跟踪")])]),t._v(" "),n("tr",[n("td",[t._v("profile")]),t._v(" "),n("td",[t._v("默认进行 30s 的 cpu profiling, 得到一个分析用的 profile 文件")])]),t._v(" "),n("tr",[n("td",[t._v("threadcreate")]),t._v(" "),n("td",[t._v("查看创建 os 线程的堆栈跟踪")])])])]),t._v(" "),n("blockquote",[n("p",[t._v("?debug=1 : 直接在浏览器访问,否则下载文件,在部署环境,我们为了网络安全通常不会直接对外暴露 pprof 的相关端口,因此通过 curl、wget 等方式进行 profile 文件的间接拉取.")])]),t._v(" "),n("h2",{attrs:{id:"通过交互终端使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#通过交互终端使用"}},[t._v("#")]),t._v(" 通过交互终端使用")]),t._v(" "),n("h3",{attrs:{id:"cpu-profiling"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cpu-profiling"}},[t._v("#")]),t._v(" cpu profiling")]),t._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cpu profiling")]),t._v("\ngo tool pprof http://localhost:6060/debug/pprof/profile"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("?seconds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v("\ngo tool pprof https+insecure://localhost:6060/debug/pprof/profile"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("?seconds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# TLS 方式")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])]),n("h4",{attrs:{id:"top10命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#top10命令"}},[t._v("#")]),t._v(" top10命令")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("名称")]),t._v(" "),n("th",[t._v("备注")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("flat")]),t._v(" "),n("td",[t._v("函数自身的运行耗时")])]),t._v(" "),n("tr",[n("td",[t._v("flat%")]),t._v(" "),n("td",[t._v("函数自身在 cpu 运行耗时总比例")])]),t._v(" "),n("tr",[n("td",[t._v("sum%")]),t._v(" "),n("td",[t._v("函数自身累计使用 cpu 总比例")])]),t._v(" "),n("tr",[n("td",[t._v("cum")]),t._v(" "),n("td",[t._v("函数自身及其调用函数的运行总耗时")])]),t._v(" "),n("tr",[n("td",[t._v("cum%")]),t._v(" "),n("td",[t._v("函数自身及其调用函数的运行耗时总比例")])]),t._v(" "),n("tr",[n("td",[t._v("Name")]),t._v(" "),n("td",[t._v("函数名")])])])]),t._v(" "),n("blockquote",[n("p",[t._v("可以通过这五列得出一个应用程序的运行情况,当前时什么函数正在做什么事情,占用多少资源得到一个初步的分析方向")])]),t._v(" "),n("h3",{attrs:{id:"heap-profiling"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#heap-profiling"}},[t._v("#")]),t._v(" heap profiling")]),t._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# heap Profiling")]),t._v("\ngo tool pprof http://localhost:6060/debug/pprof/heap "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以很快拿到结果不像 cpu 需要采用")]),t._v("\ngo tool pprof -inuse_space http://localhost:6060/debug/pprof/heap "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 分析应用程序常驻内存占用情况")]),t._v("\ngo tool pprof -alloc_objects http://localhost:6060/debug/pprof/heap "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 分析应用程序内存临时分配情况")]),t._v("\ngo tool pprof -inuse_objects http://localhost:6060/debug/pprof/heap "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看每个函数分配的对象数量")]),t._v("\ngo tool pprof -alloc_space http://localhost:6060/debug/pprof/heap "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看分配的内存空间")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br")])]),n("h3",{attrs:{id:"goroutine-profiling"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#goroutine-profiling"}},[t._v("#")]),t._v(" goroutine profiling")]),t._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("go tool pprof http://localhost:6060/debug/pprof/goroutine\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("h4",{attrs:{id:"traces"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#traces"}},[t._v("#")]),t._v(" traces")]),t._v(" "),n("p",[t._v("打印对应的所有调用栈,及指标可以查看调用链路,调用栈展示顺序是自下而上的.")]),t._v(" "),n("h3",{attrs:{id:"mutex-profiling"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mutex-profiling"}},[t._v("#")]),t._v(" Mutex Profiling")]),t._v(" "),n("h4",{attrs:{id:"top"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#top"}},[t._v("#")]),t._v(" top")]),t._v(" "),n("p",[t._v("查看互斥量排名")]),t._v(" "),n("h4",{attrs:{id:"list"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#list"}},[t._v("#")]),t._v(" list")]),t._v(" "),n("p",[t._v("查看指定函数的代码情况")]),t._v(" "),n("h2",{attrs:{id:"查看可视化界面"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看可视化界面"}},[t._v("#")]),t._v(" 查看可视化界面")]),t._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" http://localhost:6060/debug/pprof/profile\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("p",[t._v("默认需要等待 30s,执行完后可在当前目录下发现采样文件 profile")]),t._v(" "),n("h3",{attrs:{id:"方法一-推荐"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方法一-推荐"}},[t._v("#")]),t._v(" 方法一(推荐)")]),t._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("go tool pprof -http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(":6001 profile\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("p",[t._v("该命令将在所指定的端口运行一个 pprof 分析用的站点")]),t._v(" "),n("h3",{attrs:{id:"方法二-需要安装-graphviz"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方法二-需要安装-graphviz"}},[t._v("#")]),t._v(" 方法二(需要安装 graphviz)")]),t._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("go tool pprof profile "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进入")]),t._v("\nweb "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# web 命令将 svg 文件格式写入图形,然后在浏览器中打开")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br")])]),n("p",[n("img",{attrs:{src:a(399),alt:"go-tool-pprof"}})]),t._v(" "),n("h4",{attrs:{id:"top-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#top-2"}},[t._v("#")]),t._v(" top")]),t._v(" "),n("p",[t._v("与 top 子命令相同")]),t._v(" "),n("h4",{attrs:{id:"graph"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#graph"}},[t._v("#")]),t._v(" Graph")]),t._v(" "),n("p",[t._v("框越大,线越粗,颜色越红占用时间越长,开销越大.,分析哪开销较大,什么调用流程调用的.")]),t._v(" "),n("h4",{attrs:{id:"peek"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#peek"}},[t._v("#")]),t._v(" peek")]),t._v(" "),n("p",[t._v("相比于 top 增加了上下文信息,也就是函数的输出调用者和被调用者")]),t._v(" "),n("h4",{attrs:{id:"source"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#source"}},[t._v("#")]),t._v(" source")]),t._v(" "),n("p",[t._v("增加了面向源代码的追踪和分析.可以看到开销主要消耗在哪里")]),t._v(" "),n("h4",{attrs:{id:"flame-graph"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#flame-graph"}},[t._v("#")]),t._v(" flame Graph")]),t._v(" "),n("p",[t._v("火焰图,他是动态的,调用顺序由上而下,每一块代表一个函数,颜色越红、区块越大代表占用 cpu 时间越长,")]),t._v(" "),n("h2",{attrs:{id:"通过测试用例作剖析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#通过测试用例作剖析"}},[t._v("#")]),t._v(" 通过测试用例作剖析")]),t._v(" "),n("div",{staticClass:"language-go line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("TestAdd")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("testing"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("T"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Add")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello world"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("BenchmarkAdd")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("testing"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("N"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Add")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello world"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br")])]),n("h4",{attrs:{id:"采集"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#采集"}},[t._v("#")]),t._v(" 采集")]),t._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("go "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v(" -bench"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(". -cpuprofile"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("cpu.profile "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cpu")]),t._v("\ngo "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v(" -bench"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(". -memprofile"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("mem.profile "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mem")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);