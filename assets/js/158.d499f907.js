(window.webpackJsonp=window.webpackJsonp||[]).push([[158],{717:function(s,a,t){"use strict";t.r(a);var n=t(20),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"logrotate"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#logrotate"}},[s._v("#")]),s._v(" logrotate")]),s._v(" "),t("h2",{attrs:{id:"命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#命令"}},[s._v("#")]),s._v(" 命令")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("logrotate")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTION"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("configfile"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[s._v("#")]),s._v(" 配置文件")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("/etc/logrotate.conf\n/etc/logrotate.d/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("weekly "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认每周执行一次")]),s._v("\nrotate "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保留4周的积压值,0为不保留")]),s._v("\ncreate "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自动创建新文件")]),s._v("\ndateext "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用日期做切割文件后缀,如果注释掉则数字递增")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#compress # 如果要压缩日志文件取消注释")]),s._v("\ninclude /etc/logrotate.d "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自定义配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 系统特定日志也可以在这里配置")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h2",{attrs:{id:"参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参数"}},[s._v("#")]),s._v(" 参数")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("参数")]),s._v(" "),t("th",[s._v("作用")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("-d, --debug")]),s._v(" "),t("td",[s._v("测试配置文件是否有错误")])]),s._v(" "),t("tr",[t("td",[s._v("-f, --force")]),s._v(" "),t("td",[s._v("强制切割文件")])]),s._v(" "),t("tr",[t("td",[s._v("-m, --mail=command")]),s._v(" "),t("td",[s._v("压缩日志后发送到指定邮箱")])]),s._v(" "),t("tr",[t("td",[s._v("-s, --state=statefile")]),s._v(" "),t("td",[s._v("使用指定的状态文件")])]),s._v(" "),t("tr",[t("td",[s._v("-v, --verbose")]),s._v(" "),t("td",[s._v("显示转储过程")])])])]),s._v(" "),t("h2",{attrs:{id:"执行脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行脚本"}},[s._v("#")]),s._v(" 执行脚本")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("/etc/cron.daily/logrotate\n/usr/sbin/logrotate -f /etc/logrotate.d/nginx    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不能 cron 周期手动强制切割日志")]),s._v("\n/usr/sbin/logrotate -d -f /etc/logrotate.d/nginx "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# debug 根据设置执行,输出详细信息,但是不会有实际操作")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"执行结果"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行结果"}},[s._v("#")]),s._v(" 执行结果")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /var/lib/logrotate.status\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[s._v("#")]),s._v(" 示例")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("// "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/logrotate.d/nginx\n/usr/local/nginx/logs/*.log "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\ndaily\nrotate "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("\nmissingok\nnotifempty\ndateext\nsharedscripts\npostrotate\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -f /usr/local/nginx/logs/nginx.pid "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" -USR1 "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /usr/local/nginx/logs/nginx.pid"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\nendscript\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h2",{attrs:{id:"其他配置参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其他配置参数"}},[s._v("#")]),s._v(" 其他配置参数")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("compress                                   通过gzip 压缩转储以后的日志\nnocompress                                不做gzip压缩处理\ncopytruncate                              用于还在打开中的日志文件，把当前日志备份并截断；是先拷贝再清空的方式，拷贝和清空之间有一个时间差，可能会丢失部分日志数据。\nnocopytruncate                           备份日志文件不过不截断\ncreate mode owner group             轮转时指定创建新文件的属性，如create 0777 nobody nobody\nnocreate                                    不建立新的日志文件\ndelaycompress                           和compress 一起使用时，转储的日志文件到下一次转储时才压缩\nnodelaycompress                        覆盖 delaycompress 选项，转储同时压缩。\nmissingok                                 如果日志丢失，不报错继续滚动下一个日志\nerrors address                           专储时的错误信息发送到指定的Email 地址\nifempty                                    即使日志文件为空文件也做轮转，这个是logrotate的缺省选项。\nnotifempty                               当日志文件为空时，不进行轮转\nmail address                             把转储的日志文件发送到指定的E-mail 地址\nnomail                                     转储时不发送日志文件\nolddir directory                         转储后的日志文件放入指定的目录，必须和当前日志文件在同一个文件系统\nnoolddir                                   转储后的日志文件和当前日志文件放在同一个目录下\nsharedscripts                           运行postrotate脚本，作用是在所有日志都轮转后统一执行一次脚本。如果没有配置这个，那么每个日志轮转后都会执行一次脚本\nprerotate                                 在logrotate转储之前需要执行的指令，例如修改文件的属性等动作；必须独立成行\npostrotate                               在logrotate转储之后需要执行的指令，例如重新启动 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kill -HUP"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 某个服务！必须独立成行\ndaily                                       指定转储周期为每天\nweekly                                    指定转储周期为每周\nmonthly                                  指定转储周期为每月\nrotate count                            指定日志文件删除之前转储的次数，0 指没有备份，5 指保留5 个备份\ndateext                                  使用当期日期作为命名格式\ndateformat .%s                       配合dateext使用，紧跟在下一行出现，定义文件切割后的文件名，必须配合dateext使用，只支持 %Y %m %d %s 这四个参数\nsize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("或minsize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" log-size            当日志文件到达指定的大小时才转储，log-size能指定bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("缺省"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("及KB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sizek"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("或MB"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sizem"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".\n当日志文件 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" log-size 的时候就转储。 以下为合法格式：（其他格式的单位大小写没有试过）\nsize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" 或 size "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" （"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" 个字节就转储）\nsize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 100k 或 size 100k\nsize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 100M 或 size 100M\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);