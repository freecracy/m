(window.webpackJsonp=window.webpackJsonp||[]).push([[162],{723:function(s,t,a){"use strict";a.r(t);var e=a(20),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"tc模拟弱网"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tc模拟弱网"}},[s._v("#")]),s._v(" tc模拟弱网")]),s._v(" "),a("h2",{attrs:{id:"简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),a("p",[s._v("tc 是 iproute2 工具包的一部分,主要通过在输出端口处建立一个队列来实现流量控制.一般只能限制网卡发送的数据包,不太好限制网卡接收的数据包,所以可以通过改变发送次序来控制传输速率, linux 流量控制主要在输出接口排列时进行处理和实现的.")]),s._v(" "),a("p",[s._v("在 tc 配置 netem 的操作时主要有4个控制参数")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("参数")]),s._v(" "),a("th",[s._v("作用")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("add")]),s._v(" "),a("td",[s._v("为指定网卡添加 netem 配置")])]),s._v(" "),a("tr",[a("td",[s._v("change")]),s._v(" "),a("td",[s._v("修改已存在的 netem 配置")])]),s._v(" "),a("tr",[a("td",[s._v("replace")]),s._v(" "),a("td",[s._v("替换已存在的 netem 配置值")])]),s._v(" "),a("tr",[a("td",[s._v("del")]),s._v(" "),a("td",[s._v("删除网卡上的 netem 配置")])])])]),s._v(" "),a("h2",{attrs:{id:"延迟"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#延迟"}},[s._v("#")]),s._v(" 延迟")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("tc qdisc "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" devv eth0 root netem daly 100ms "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所有报文延迟 100ms 发送,qdisc 是排序规则")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("table",[a("thead",[a("tr",[a("th",[s._v("参数")]),s._v(" "),a("th",[s._v("作用")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("jittter")]),s._v(" "),a("td",[s._v("网络抖动,增加一个随机事件长度,让延迟时间出现在某个范围")])]),s._v(" "),a("tr",[a("td",[s._v("correlation")]),s._v(" "),a("td",[s._v("相关系数,下一个报文延迟事件和上一个报文的相关系数")])]),s._v(" "),a("tr",[a("td",[s._v("distribution")]),s._v(" "),a("td",[s._v("延迟分布,可选值 uniform、normal、pareto、paretonomal")])])])]),s._v(" "),a("h2",{attrs:{id:"丢包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#丢包"}},[s._v("#")]),s._v(" 丢包")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("tc qdisc "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" dev eth0 root netem loss "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("% "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("%\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"包重复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#包重复"}},[s._v("#")]),s._v(" 包重复")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("tc qdisc "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" dev eth0 root netem duplicate "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("% "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 模拟包重复")]),s._v("\ntc qdisc "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" dev eth0 root netem corrupt "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 模拟包损坏")]),s._v("\ntc qdisc "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" dev eth0 root netem reorder "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("% gap "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" delay 100ms "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 模拟包乱序,每隔 3s 正常发送,其他延迟 100s 发送")]),s._v("\ntc qdisc "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" dev eth0 root netem reorder "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("% "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("% delay 300ms "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用概率模拟包乱序, 50% 正常发送,其他延迟 200s 发送")]),s._v("\ntc show "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前配置了哪些条件")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"查看半连接队列和全连接队列"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看半连接队列和全连接队列"}},[s._v("#")]),s._v(" 查看半连接队列和全连接队列")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("ss -lnt\nlisten\nrecv-Q "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 全连接队列大小\nsend-Q "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 全连接最大长度\n非 listen\nrecv-Q "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 已收到但未被应用程序读取的\nsend-Q "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 已发送但未收到确认的字节数\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -s "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" overflowd 查看超过全连接限制丢弃的tcp连接\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])])])}),[],!1,null,null,null);t.default=n.exports}}]);