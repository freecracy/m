<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>集群 | 嗯哼人生</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    <meta name="referrer" content="no-referrer">
    
    <link rel="preload" href="/m/assets/css/0.styles.1e386fb6.css" as="style"><link rel="preload" href="/m/assets/js/app.71fdaff2.js" as="script"><link rel="preload" href="/m/assets/js/2.351ead77.js" as="script"><link rel="preload" href="/m/assets/js/41.d23cf8c8.js" as="script"><link rel="prefetch" href="/m/assets/js/10.98c1e7e0.js"><link rel="prefetch" href="/m/assets/js/100.d7774ae1.js"><link rel="prefetch" href="/m/assets/js/101.0d4dea0d.js"><link rel="prefetch" href="/m/assets/js/102.6867f859.js"><link rel="prefetch" href="/m/assets/js/103.9d24bd08.js"><link rel="prefetch" href="/m/assets/js/104.4d59f256.js"><link rel="prefetch" href="/m/assets/js/105.ff49af8e.js"><link rel="prefetch" href="/m/assets/js/106.b26c7611.js"><link rel="prefetch" href="/m/assets/js/107.da5be320.js"><link rel="prefetch" href="/m/assets/js/108.0c03f842.js"><link rel="prefetch" href="/m/assets/js/109.5587de24.js"><link rel="prefetch" href="/m/assets/js/11.4e6d88d4.js"><link rel="prefetch" href="/m/assets/js/110.40ae6022.js"><link rel="prefetch" href="/m/assets/js/111.0353ccf3.js"><link rel="prefetch" href="/m/assets/js/112.f562c096.js"><link rel="prefetch" href="/m/assets/js/113.7926c003.js"><link rel="prefetch" href="/m/assets/js/114.356035f0.js"><link rel="prefetch" href="/m/assets/js/115.15e5e23e.js"><link rel="prefetch" href="/m/assets/js/116.2db2b1ed.js"><link rel="prefetch" href="/m/assets/js/117.2658e42c.js"><link rel="prefetch" href="/m/assets/js/118.037a8503.js"><link rel="prefetch" href="/m/assets/js/119.21153540.js"><link rel="prefetch" href="/m/assets/js/12.c3dadd73.js"><link rel="prefetch" href="/m/assets/js/120.b8f0644f.js"><link rel="prefetch" href="/m/assets/js/121.4c1c263a.js"><link rel="prefetch" href="/m/assets/js/122.d6ba18dd.js"><link rel="prefetch" href="/m/assets/js/123.ceef4883.js"><link rel="prefetch" href="/m/assets/js/124.9e5f50ca.js"><link rel="prefetch" href="/m/assets/js/125.de1ddc80.js"><link rel="prefetch" href="/m/assets/js/126.ae350aea.js"><link rel="prefetch" href="/m/assets/js/127.4636f6be.js"><link rel="prefetch" href="/m/assets/js/128.13b379ab.js"><link rel="prefetch" href="/m/assets/js/129.e7b0a15f.js"><link rel="prefetch" href="/m/assets/js/13.a52bd89b.js"><link rel="prefetch" href="/m/assets/js/130.147cdf11.js"><link rel="prefetch" href="/m/assets/js/131.c7a07871.js"><link rel="prefetch" href="/m/assets/js/132.faf72eb9.js"><link rel="prefetch" href="/m/assets/js/133.6301923b.js"><link rel="prefetch" href="/m/assets/js/134.4357c6e4.js"><link rel="prefetch" href="/m/assets/js/135.0ea43a3d.js"><link rel="prefetch" href="/m/assets/js/136.5a7c2377.js"><link rel="prefetch" href="/m/assets/js/137.393c998e.js"><link rel="prefetch" href="/m/assets/js/138.dcf958b6.js"><link rel="prefetch" href="/m/assets/js/139.1ccac68b.js"><link rel="prefetch" href="/m/assets/js/14.96fff293.js"><link rel="prefetch" href="/m/assets/js/140.938c314e.js"><link rel="prefetch" href="/m/assets/js/141.03cc2137.js"><link rel="prefetch" href="/m/assets/js/142.db00aba9.js"><link rel="prefetch" href="/m/assets/js/143.6d7b22af.js"><link rel="prefetch" href="/m/assets/js/144.850ed5a9.js"><link rel="prefetch" href="/m/assets/js/145.a1958a5f.js"><link rel="prefetch" href="/m/assets/js/146.1b350d4f.js"><link rel="prefetch" href="/m/assets/js/147.961f3ccd.js"><link rel="prefetch" href="/m/assets/js/148.cb4f8811.js"><link rel="prefetch" href="/m/assets/js/149.45ad7c2c.js"><link rel="prefetch" href="/m/assets/js/15.c507965f.js"><link rel="prefetch" href="/m/assets/js/150.5d952b70.js"><link rel="prefetch" href="/m/assets/js/151.5c794bb0.js"><link rel="prefetch" href="/m/assets/js/152.974e657e.js"><link rel="prefetch" href="/m/assets/js/153.b7cf98f6.js"><link rel="prefetch" href="/m/assets/js/154.be904394.js"><link rel="prefetch" href="/m/assets/js/155.769e3b0d.js"><link rel="prefetch" href="/m/assets/js/156.6107a44f.js"><link rel="prefetch" href="/m/assets/js/157.0bf74a2b.js"><link rel="prefetch" href="/m/assets/js/158.d499f907.js"><link rel="prefetch" href="/m/assets/js/159.6b2acd2c.js"><link rel="prefetch" href="/m/assets/js/16.247520d0.js"><link rel="prefetch" href="/m/assets/js/160.ec909209.js"><link rel="prefetch" href="/m/assets/js/161.4832768d.js"><link rel="prefetch" href="/m/assets/js/162.ae74834a.js"><link rel="prefetch" href="/m/assets/js/163.8af51be9.js"><link rel="prefetch" href="/m/assets/js/164.0d64a1ef.js"><link rel="prefetch" href="/m/assets/js/165.5e5a775c.js"><link rel="prefetch" href="/m/assets/js/166.121987f8.js"><link rel="prefetch" href="/m/assets/js/167.1c270942.js"><link rel="prefetch" href="/m/assets/js/168.200df8c8.js"><link rel="prefetch" href="/m/assets/js/169.84f5e0d7.js"><link rel="prefetch" href="/m/assets/js/17.3cb462b5.js"><link rel="prefetch" href="/m/assets/js/170.57b7eec5.js"><link rel="prefetch" href="/m/assets/js/171.d993d636.js"><link rel="prefetch" href="/m/assets/js/172.820d00a1.js"><link rel="prefetch" href="/m/assets/js/173.cc29ff6e.js"><link rel="prefetch" href="/m/assets/js/174.99d62af7.js"><link rel="prefetch" href="/m/assets/js/175.da874148.js"><link rel="prefetch" href="/m/assets/js/176.d0755bfc.js"><link rel="prefetch" href="/m/assets/js/177.8b00d874.js"><link rel="prefetch" href="/m/assets/js/178.2b0cfda8.js"><link rel="prefetch" href="/m/assets/js/179.780a3873.js"><link rel="prefetch" href="/m/assets/js/18.298da910.js"><link rel="prefetch" href="/m/assets/js/180.7c0ac3dc.js"><link rel="prefetch" href="/m/assets/js/181.507f9073.js"><link rel="prefetch" href="/m/assets/js/182.87f76d4a.js"><link rel="prefetch" href="/m/assets/js/183.1410502e.js"><link rel="prefetch" href="/m/assets/js/184.80666cb3.js"><link rel="prefetch" href="/m/assets/js/185.dc628b97.js"><link rel="prefetch" href="/m/assets/js/186.c2560a3f.js"><link rel="prefetch" href="/m/assets/js/187.6af43ea3.js"><link rel="prefetch" href="/m/assets/js/188.da75b50c.js"><link rel="prefetch" href="/m/assets/js/189.78dd960b.js"><link rel="prefetch" href="/m/assets/js/19.d9eabdf8.js"><link rel="prefetch" href="/m/assets/js/190.017586b9.js"><link rel="prefetch" href="/m/assets/js/191.5fa65eb7.js"><link rel="prefetch" href="/m/assets/js/192.5bb628c7.js"><link rel="prefetch" href="/m/assets/js/193.35707c80.js"><link rel="prefetch" href="/m/assets/js/194.35c3b13b.js"><link rel="prefetch" href="/m/assets/js/195.6dc8874b.js"><link rel="prefetch" href="/m/assets/js/196.01a1e825.js"><link rel="prefetch" href="/m/assets/js/197.5745084a.js"><link rel="prefetch" href="/m/assets/js/198.0455ca12.js"><link rel="prefetch" href="/m/assets/js/199.75129c13.js"><link rel="prefetch" href="/m/assets/js/20.ce14ddb9.js"><link rel="prefetch" href="/m/assets/js/200.a08681d0.js"><link rel="prefetch" href="/m/assets/js/201.a54018b7.js"><link rel="prefetch" href="/m/assets/js/202.2361e839.js"><link rel="prefetch" href="/m/assets/js/203.b92491ee.js"><link rel="prefetch" href="/m/assets/js/204.13742571.js"><link rel="prefetch" href="/m/assets/js/205.b066e447.js"><link rel="prefetch" href="/m/assets/js/206.e2c72f2c.js"><link rel="prefetch" href="/m/assets/js/207.09a83a9a.js"><link rel="prefetch" href="/m/assets/js/208.f4b8d71c.js"><link rel="prefetch" href="/m/assets/js/209.1a4e4d18.js"><link rel="prefetch" href="/m/assets/js/21.0dc0e0bf.js"><link rel="prefetch" href="/m/assets/js/210.9709d46f.js"><link rel="prefetch" href="/m/assets/js/211.3704916b.js"><link rel="prefetch" href="/m/assets/js/212.7c96c99f.js"><link rel="prefetch" href="/m/assets/js/213.b4aedaa1.js"><link rel="prefetch" href="/m/assets/js/214.d0b2586b.js"><link rel="prefetch" href="/m/assets/js/215.2268650a.js"><link rel="prefetch" href="/m/assets/js/216.dcaa6f2f.js"><link rel="prefetch" href="/m/assets/js/217.33aaf649.js"><link rel="prefetch" href="/m/assets/js/218.216d8592.js"><link rel="prefetch" href="/m/assets/js/219.44d35873.js"><link rel="prefetch" href="/m/assets/js/22.ce355d8a.js"><link rel="prefetch" href="/m/assets/js/220.ff06fa11.js"><link rel="prefetch" href="/m/assets/js/221.93379b76.js"><link rel="prefetch" href="/m/assets/js/222.6f0bbeea.js"><link rel="prefetch" href="/m/assets/js/223.4c5e29f0.js"><link rel="prefetch" href="/m/assets/js/224.e7be32e4.js"><link rel="prefetch" href="/m/assets/js/225.4915db8f.js"><link rel="prefetch" href="/m/assets/js/226.60f21d11.js"><link rel="prefetch" href="/m/assets/js/227.0e63cf34.js"><link rel="prefetch" href="/m/assets/js/228.e7b7a543.js"><link rel="prefetch" href="/m/assets/js/229.73bf392a.js"><link rel="prefetch" href="/m/assets/js/23.40c917ac.js"><link rel="prefetch" href="/m/assets/js/230.9f789c55.js"><link rel="prefetch" href="/m/assets/js/231.8fd85bc2.js"><link rel="prefetch" href="/m/assets/js/232.e6c4a62c.js"><link rel="prefetch" href="/m/assets/js/233.45636bf3.js"><link rel="prefetch" href="/m/assets/js/234.5194ce16.js"><link rel="prefetch" href="/m/assets/js/235.15ba019b.js"><link rel="prefetch" href="/m/assets/js/236.ac5768c1.js"><link rel="prefetch" href="/m/assets/js/237.91ec2e5a.js"><link rel="prefetch" href="/m/assets/js/238.af630344.js"><link rel="prefetch" href="/m/assets/js/239.b2b84093.js"><link rel="prefetch" href="/m/assets/js/24.5b681006.js"><link rel="prefetch" href="/m/assets/js/240.9c9b1fba.js"><link rel="prefetch" href="/m/assets/js/241.c26c2147.js"><link rel="prefetch" href="/m/assets/js/242.ce44f37f.js"><link rel="prefetch" href="/m/assets/js/243.aa04b829.js"><link rel="prefetch" href="/m/assets/js/244.ee4c9090.js"><link rel="prefetch" href="/m/assets/js/245.62ebda1d.js"><link rel="prefetch" href="/m/assets/js/246.2fd9ce22.js"><link rel="prefetch" href="/m/assets/js/247.52b3e746.js"><link rel="prefetch" href="/m/assets/js/248.2e432a32.js"><link rel="prefetch" href="/m/assets/js/249.4598fccb.js"><link rel="prefetch" href="/m/assets/js/25.d5d6ba55.js"><link rel="prefetch" href="/m/assets/js/250.7c93bc3e.js"><link rel="prefetch" href="/m/assets/js/251.4d402930.js"><link rel="prefetch" href="/m/assets/js/252.1b3fb775.js"><link rel="prefetch" href="/m/assets/js/253.01a9b4f8.js"><link rel="prefetch" href="/m/assets/js/254.29de4256.js"><link rel="prefetch" href="/m/assets/js/255.4911ce12.js"><link rel="prefetch" href="/m/assets/js/256.0a40f8d2.js"><link rel="prefetch" href="/m/assets/js/257.2111ae5e.js"><link rel="prefetch" href="/m/assets/js/258.0e9b2cd1.js"><link rel="prefetch" href="/m/assets/js/259.43158d35.js"><link rel="prefetch" href="/m/assets/js/26.b1e00e8a.js"><link rel="prefetch" href="/m/assets/js/260.72ea8c45.js"><link rel="prefetch" href="/m/assets/js/261.3f679643.js"><link rel="prefetch" href="/m/assets/js/262.d9ecaed6.js"><link rel="prefetch" href="/m/assets/js/27.556976c4.js"><link rel="prefetch" href="/m/assets/js/28.11027d56.js"><link rel="prefetch" href="/m/assets/js/29.f40ac6f5.js"><link rel="prefetch" href="/m/assets/js/3.a2a1a8e5.js"><link rel="prefetch" href="/m/assets/js/30.3b59bb10.js"><link rel="prefetch" href="/m/assets/js/31.c37142be.js"><link rel="prefetch" href="/m/assets/js/32.c5e0d2a0.js"><link rel="prefetch" href="/m/assets/js/33.4f5f3a8d.js"><link rel="prefetch" href="/m/assets/js/34.4a3a9398.js"><link rel="prefetch" href="/m/assets/js/35.77f89f97.js"><link rel="prefetch" href="/m/assets/js/36.6ea00d3c.js"><link rel="prefetch" href="/m/assets/js/37.b5a3b5b4.js"><link rel="prefetch" href="/m/assets/js/38.24b26621.js"><link rel="prefetch" href="/m/assets/js/39.ab372876.js"><link rel="prefetch" href="/m/assets/js/4.b9f14f77.js"><link rel="prefetch" href="/m/assets/js/40.7a81caac.js"><link rel="prefetch" href="/m/assets/js/42.ef938986.js"><link rel="prefetch" href="/m/assets/js/43.708a3cf3.js"><link rel="prefetch" href="/m/assets/js/44.f705f7de.js"><link rel="prefetch" href="/m/assets/js/45.0e6afdb6.js"><link rel="prefetch" href="/m/assets/js/46.9815c7cc.js"><link rel="prefetch" href="/m/assets/js/47.5d1c1dcc.js"><link rel="prefetch" href="/m/assets/js/48.d9d571a6.js"><link rel="prefetch" href="/m/assets/js/49.9cbaa1e9.js"><link rel="prefetch" href="/m/assets/js/5.57dbdc35.js"><link rel="prefetch" href="/m/assets/js/50.265f94f4.js"><link rel="prefetch" href="/m/assets/js/51.094b2e7f.js"><link rel="prefetch" href="/m/assets/js/52.8b7101c0.js"><link rel="prefetch" href="/m/assets/js/53.98f3fc0b.js"><link rel="prefetch" href="/m/assets/js/54.b3d830fd.js"><link rel="prefetch" href="/m/assets/js/55.fb9cd8c7.js"><link rel="prefetch" href="/m/assets/js/56.878cf94b.js"><link rel="prefetch" href="/m/assets/js/57.1c819831.js"><link rel="prefetch" href="/m/assets/js/58.ac3faf70.js"><link rel="prefetch" href="/m/assets/js/59.b0483bf9.js"><link rel="prefetch" href="/m/assets/js/6.a0c51186.js"><link rel="prefetch" href="/m/assets/js/60.48c301e6.js"><link rel="prefetch" href="/m/assets/js/61.4bf4f2e7.js"><link rel="prefetch" href="/m/assets/js/62.d927584b.js"><link rel="prefetch" href="/m/assets/js/63.b72a48f3.js"><link rel="prefetch" href="/m/assets/js/64.6923d7c8.js"><link rel="prefetch" href="/m/assets/js/65.042fc335.js"><link rel="prefetch" href="/m/assets/js/66.1afdb278.js"><link rel="prefetch" href="/m/assets/js/67.04f7b0c7.js"><link rel="prefetch" href="/m/assets/js/68.97789db4.js"><link rel="prefetch" href="/m/assets/js/69.d914e9f8.js"><link rel="prefetch" href="/m/assets/js/7.aef5e50f.js"><link rel="prefetch" href="/m/assets/js/70.84845956.js"><link rel="prefetch" href="/m/assets/js/71.d6e9132a.js"><link rel="prefetch" href="/m/assets/js/72.2c1f5783.js"><link rel="prefetch" href="/m/assets/js/73.789e9372.js"><link rel="prefetch" href="/m/assets/js/74.e79f4842.js"><link rel="prefetch" href="/m/assets/js/75.4a389066.js"><link rel="prefetch" href="/m/assets/js/76.f5721f28.js"><link rel="prefetch" href="/m/assets/js/77.e6ce992d.js"><link rel="prefetch" href="/m/assets/js/78.5c31237a.js"><link rel="prefetch" href="/m/assets/js/79.6a4f09e0.js"><link rel="prefetch" href="/m/assets/js/8.aac4a85a.js"><link rel="prefetch" href="/m/assets/js/80.23b925ca.js"><link rel="prefetch" href="/m/assets/js/81.bc8138cb.js"><link rel="prefetch" href="/m/assets/js/82.4783bc83.js"><link rel="prefetch" href="/m/assets/js/83.1be8f057.js"><link rel="prefetch" href="/m/assets/js/84.3132660e.js"><link rel="prefetch" href="/m/assets/js/85.95c5ab8b.js"><link rel="prefetch" href="/m/assets/js/86.17c9a201.js"><link rel="prefetch" href="/m/assets/js/87.daa0da6b.js"><link rel="prefetch" href="/m/assets/js/88.9409cacc.js"><link rel="prefetch" href="/m/assets/js/89.bf04eaa0.js"><link rel="prefetch" href="/m/assets/js/9.0dd0ff11.js"><link rel="prefetch" href="/m/assets/js/90.5e1e2630.js"><link rel="prefetch" href="/m/assets/js/91.6466b581.js"><link rel="prefetch" href="/m/assets/js/92.0dd7ffc6.js"><link rel="prefetch" href="/m/assets/js/93.045047c7.js"><link rel="prefetch" href="/m/assets/js/94.ce06dedb.js"><link rel="prefetch" href="/m/assets/js/95.f673ef28.js"><link rel="prefetch" href="/m/assets/js/96.1f73d13d.js"><link rel="prefetch" href="/m/assets/js/97.b1800fdc.js"><link rel="prefetch" href="/m/assets/js/98.245eb5e4.js"><link rel="prefetch" href="/m/assets/js/99.2cfc78a1.js">
    <link rel="stylesheet" href="/m/assets/css/0.styles.1e386fb6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/m/" class="home-link router-link-active"><!----> <span class="site-name">嗯哼人生</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/m/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://cn100800.tk" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="mailto:freecracy1024@gmail.com" class="nav-link external">
  mail
  <!----></a></div><div class="nav-item"><a href="https://google.com.hk" target="_blank" rel="noopener noreferrer" class="nav-link external">
  google
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/m/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://cn100800.tk" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="mailto:freecracy1024@gmail.com" class="nav-link external">
  mail
  <!----></a></div><div class="nav-item"><a href="https://google.com.hk" target="_blank" rel="noopener noreferrer" class="nav-link external">
  google
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Go语言之旅</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Redis</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/m/Redis/命令合集.html" class="sidebar-link">命令合集</a></li><li><a href="/m/Redis/RedLock.html" class="sidebar-link">RedLock</a></li><li><a href="/m/Redis/etcd.html" class="sidebar-link">etcd</a></li><li><a href="/m/Redis/redis变慢.html" class="sidebar-link">redis 变慢</a></li><li><a href="/m/Redis/事件机制.html" class="sidebar-link">事件机制</a></li><li><a href="/m/Redis/事务.html" class="sidebar-link">事务</a></li><li><a href="/m/Redis/内存碎片.html" class="sidebar-link">内存碎片</a></li><li><a href="/m/Redis/基础.html" class="sidebar-link">基础</a></li><li><a href="/m/Redis/客户端缓存.html" class="sidebar-link">客户端缓存</a></li><li><a href="/m/Redis/数据类型.html" class="sidebar-link">数据类型</a></li><li><a href="/m/Redis/缓存策略.html" class="sidebar-link">缓存策略</a></li><li><a href="/m/Redis/集群.html" class="active sidebar-link">集群</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/m/Redis/集群.html#扩容缩容" class="sidebar-link">扩容缩容</a></li><li class="sidebar-sub-header"><a href="/m/Redis/集群.html#故障发现和恢复" class="sidebar-link">故障发现和恢复</a></li><li class="sidebar-sub-header"><a href="/m/Redis/集群.html#redis6-0" class="sidebar-link">Redis6.0</a></li><li class="sidebar-sub-header"><a href="/m/Redis/集群.html#配置文件" class="sidebar-link">配置文件</a></li><li class="sidebar-sub-header"><a href="/m/Redis/集群.html#消息" class="sidebar-link">消息</a></li><li class="sidebar-sub-header"><a href="/m/Redis/集群.html#主从复制" class="sidebar-link">主从复制</a></li><li class="sidebar-sub-header"><a href="/m/Redis/集群.html#一次请求-集群" class="sidebar-link">一次请求(集群)</a></li><li class="sidebar-sub-header"><a href="/m/Redis/集群.html#部署" class="sidebar-link">部署</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Deno</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其他</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>周末闲谈</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>深度好文</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>漫步 Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>鸡汤软文</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="集群"><a href="#集群" class="header-anchor">#</a> 集群</h1> <h2 id="扩容缩容"><a href="#扩容缩容" class="header-anchor">#</a> 扩容缩容</h2> <p>每个节点都保存槽数据,当节点数量变动时,这些槽数据就会根据虚拟槽算法被迁移到其他节点上.</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>cluster meet <span class="token function">ip</span> port
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果这个新节点是主节点需要对其进行槽数据扩容,如果这个节点是从节点,需要同步主节点数据.都需要同步数据.</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 客户端对目标节点发起准备倒入槽数据命令,让目标节点准备好倒入槽数据</span>
cluster setslot <span class="token punctuation">[</span>slot<span class="token punctuation">]</span> importing <span class="token punctuation">[</span>sourceNodeId<span class="token punctuation">]</span>
<span class="token comment"># 对原节点发送命令,准备迁出槽数据</span>
cluster setslot <span class="token punctuation">[</span>slot<span class="token punctuation">]</span> importing <span class="token punctuation">[</span>sourceNodeId<span class="token punctuation">]</span>
<span class="token comment"># 把迁移的数据获取出来, count 表示迁移个数</span>
cluster getkeysinslot <span class="token punctuation">[</span>slot<span class="token punctuation">]</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span>
<span class="token comment"># 在源节点上把获取的键通过流水线批量迁移到目标节点</span>
migrate <span class="token punctuation">[</span>targetIP<span class="token punctuation">]</span> <span class="token punctuation">[</span>torgetPort<span class="token punctuation">]</span> <span class="token string">&quot;&quot;</span> <span class="token number">0</span> <span class="token punctuation">[</span>timeout<span class="token punctuation">]</span> keys <span class="token punctuation">[</span>keys<span class="token punctuation">]</span>
<span class="token comment"># 重复以上两部迁移数据</span>
<span class="token comment"># 通知对应槽分配到目标节点,并广播给其他主节点,更新自身槽对应表</span>
cluster setslot <span class="token punctuation">[</span>slot<span class="token punctuation">]</span> node <span class="token punctuation">[</span>targetNodeId<span class="token punctuation">]</span>
<span class="token comment"># 下线时通知其他节点忘记自己,收到 forget 命令的节点会把下线节点放入仅用列表,之后不再发送ping</span>
<span class="token comment"># 不过这个表超时时间是 60 秒,超过后依旧会 ping</span>
cluster foget <span class="token punctuation">[</span>downNodeId<span class="token punctuation">]</span>
<span class="token comment"># 彻底下线</span>
redis-trib.rb del-nod<span class="token punctuation">[</span>host:port<span class="token punctuation">]</span> downNodeId
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="故障发现和恢复"><a href="#故障发现和恢复" class="header-anchor">#</a> 故障发现和恢复</h2> <p>计划下线和故障下线,故障下线分主观下线和客观下线</p> <p>主观下线 : 节点会向其他节点发送 ping 消息,正常会收到 pong 消息,同时会更新与其他节点的通讯时间,如果超过 cluster-node-timeout 会更新本地状态,标记主观下线</p> <p>客观下线 : 下线信息会通过 gossip 协议同步其他节点,半数以上标记主观下线,会启动客观下线流程,客观下线只针对主节点,从节点会忽略,将主观下线保存到本地 clusterNode 的结构中,并检查主观下线时效性,如果超过了 cluster-node-timeout * 2 会忽略这个报告.,记录报告,并且比较标记主观下线报告数量大于持有主节点数量时标记客观下线,同时向集群中广播 fail 消息通知集群中其他节点,</p> <p>恢复 :</p> <ol><li>资格检查 : 每个节点都会检查与主节点断开时间如果超过了 cluster-node-time * cluster-slave-validity-facto r(默认 10),不适合成为新的主节点</li> <li>触发选举 : 偏移量大的参与选举</li> <li>发起选举 : clusterNode.configEpoch 一个不断增加的整数,每次 ping 、pong 交互都会更新,记录每个节点版本和整个集群版本,更新完后会发起选举消息,并保证从节点在一次配置纪元中只能发起一次选举.</li> <li>替换主节点 : 新主节点选举出来后,删除原主节点负责的槽数据,把这些槽添加到自己的节点上.并广播其他节点.</li></ol> <p>每一个 sentinel 节点将会定时向 <code>_sentinel_: hello</code>频道发送消息,并且每个 sentinel 都会订阅这个频道,当 sentinel 发生主节点故障转移,客户端可以订阅 <code>+switch-master</code>频道,一旦结束故障转移就会发布主节点消息.</p> <h2 id="redis6-0"><a href="#redis6-0" class="header-anchor">#</a> Redis6.0</h2> <h3 id="客户端缓存"><a href="#客户端缓存" class="header-anchor">#</a> 客户端缓存</h3> <ol><li>普通模式:track 一个 key,当 key 修改后通知客户端,只会执行一次,一个 get 一次 track,(trackingtablemax_key,默认没有数量限制,超过上限会随机删除已有 key 并通知客户端)</li> <li>广播模式:只要键被修改或删除,符合规则的客户端会收到实效消息,服务端模式匹配增加 cpu 时间.</li> <li>转发模式:pub/sub 通知客户端</li></ol> <h3 id="多线程"><a href="#多线程" class="header-anchor">#</a> 多线程</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 后台线程执行</span>
unlink key
flushdb async
flushall async
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>4.0 的多线程主要针对大 key 删除操作</p> <p>6.0 的多线程来提供 io 读写性能,将主线程的 IO 读写拆分给一组对立的线程区执行,这样可以使多个 socket 的读写并行处理,redis 的命令依旧是主线程串行执行,性能基本提高一倍.</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>io-threads-do-reads <span class="token boolean">true</span> <span class="token comment"># 默认禁用</span>
is-threads n  <span class="token comment"># 线程数量,一旦应要小于机器核数</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/m/assets/img/redisthreads.34d702ee.png" alt="redisthreads"></p> <h3 id="cluster-proxy"><a href="#cluster-proxy" class="header-anchor">#</a> cluster-proxy</h3> <h2 id="配置文件"><a href="#配置文件" class="header-anchor">#</a> 配置文件</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>daemonize <span class="token function">yes</span>  <span class="token comment"># 设置后台启动</span>
pidfile /var/run/redis.pid <span class="token comment"># pid 文件</span>
port <span class="token number">6379</span> <span class="token comment"># 端口</span>
<span class="token builtin class-name">bind</span> <span class="token number">127.0</span>.0.1 <span class="token comment"># 主机地址 0.0.0.0 表示都可以访问 127.0.0.1 表示只允许本机访问</span>
<span class="token function">timeout</span> <span class="token number">900</span>  <span class="token comment"># 客户端闲置多长时间后关闭连接,如果指定为0,表示关闭该功能</span>
logfile stdout <span class="token comment"># 日志记录方式,默认为标准输出</span>
logfile <span class="token string">&quot;1.log&quot;</span>  <span class="token comment"># 日志文件</span>
databases <span class="token number">16</span>  <span class="token comment"># 数据库数量,默认 0</span>
save <span class="token number">900</span> <span class="token number">1</span> <span class="token comment"># 900秒（15分钟）内有1个更改</span>
save <span class="token number">300</span> <span class="token number">10</span> <span class="token comment"># 300秒（5分钟）内有10个更改</span>
save <span class="token number">60</span> <span class="token number">10000</span>  <span class="token comment"># 60秒内有10000个更改</span>
rdbcompression <span class="token function">yes</span> <span class="token comment"># 是否压缩</span>
dbfilename dump.rdb <span class="token comment"># 文件名</span>
<span class="token function">dir</span> ./    <span class="token comment"># 文件目录</span>
slaveof  <span class="token comment"># 主从同步</span>
<span class="token comment"># 如果非零，则设置SO_KEEPALIVE选项来向空闲连接的客户端发送ACK</span>
tcp-keepalive <span class="token number">60</span>
<span class="token comment"># 默认如果开启RDB快照(至少一条save指令)并且最新的后台保存失败，Redis将会停止接受写操作</span>
<span class="token comment"># 这将使用户知道数据没有正确的持久化到硬盘，否则可能没人注意到并且造成一些灾难</span>
stop-writes-on-bgsave-error <span class="token function">yes</span>
<span class="token comment"># 默认如果开启RDB快照(至少一条save指令)并且最新的后台保存失败，Redis将会停止接受写操作。</span>
stop-writes-on-bgsave-error <span class="token function">yes</span>
<span class="token comment"># 当导出到 .rdb 数据库时是否用LZF压缩字符串对象</span>
rdbcompression <span class="token function">yes</span>
<span class="token comment"># 版本5的RDB有一个CRC64算法的校验和放在了文件的最后。这将使文件格式更加可靠。</span>
rdbchecksum <span class="token function">yes</span>
<span class="token comment"># 持久化数据库的文件名</span>
dbfilename dump-master.rdb
<span class="token comment"># 工作目录</span>
<span class="token function">dir</span> /usr/local/redis-4.0.8/redis_master/
<span class="token comment"># slav服务连接master的密码</span>
masterauth testmaster123
<span class="token comment"># 当一个slave失去和master的连接，或者同步正在进行中，slave的行为可以有两种：</span>
<span class="token comment">#1) 如果 slave-serve-stale-data 设置为 &quot;yes&quot; (默认值)，slave会继续响应客户端请求，可能是正常数据，或者是过时了的数据，也可能是还没获得值的空数据。</span>
<span class="token comment"># 2) 如果 slave-serve-stale-data 设置为 &quot;no&quot;，slave会回复&quot;正在从master同步</span>
<span class="token comment"># （SYNC with master in progress）&quot;来处理各种请求，除了 INFO 和 SLAVEOF 命令。</span>
slave-serve-stale-data <span class="token function">yes</span>
<span class="token comment"># 配置是否仅读</span>
slave-read-only <span class="token function">yes</span>
<span class="token comment"># 如果你选择“yes”Redis将使用更少的TCP包和带宽来向slaves发送数据。但是这将使数据传输到slave上有延迟，Linux内核的默认配置会达到40毫秒</span>
<span class="token comment"># 如果你选择了 &quot;no&quot; 数据传输到salve的延迟将会减少但要使用更多的带宽</span>
repl-disable-tcp-nodelay no
<span class="token comment"># slave的优先级，优先级数字小的salve会优先考虑提升为master</span>
slave-priority <span class="token number">100</span>
<span class="token comment"># 密码验证</span>
requirepass testmaster123
<span class="token comment"># redis实例最大占用内存，一旦内存使用达到上限，Redis会根据选定的回收策略（参见：</span>
<span class="token comment"># maxmemmory-policy）删除key</span>
maxmemory 3gb
<span class="token comment"># 最大内存策略：如果达到内存限制了，Redis如何选择删除key。</span>
<span class="token comment"># volatile-lru -&gt; 根据LRU算法删除带有过期时间的key。</span>
<span class="token comment"># allkeys-lru -&gt; 根据LRU算法删除任何key。</span>
<span class="token comment"># volatile-random -&gt; 根据过期设置来随机删除key, 具备过期时间的key。</span>
<span class="token comment"># allkeys-&gt;random -&gt; 无差别随机删, 任何一个key。</span>
<span class="token comment"># volatile-ttl -&gt; 根据最近过期时间来删除（辅以TTL）, 这是对于有过期时间的key</span>
<span class="token comment"># noeviction -&gt; 谁也不删，直接在写操作时返回错误。</span>
maxmemory-policy volatile-lru
<span class="token comment"># AOF开启</span>
appendonly no
<span class="token comment"># aof文件名</span>
appendfilename <span class="token string">&quot;appendonly.aof&quot;</span>
<span class="token comment"># fsync() 系统调用告诉操作系统把数据写到磁盘上，而不是等更多的数据进入输出缓冲区。</span>
<span class="token comment"># 有些操作系统会真的把数据马上刷到磁盘上；有些则会尽快去尝试这么做。</span>
<span class="token comment"># Redis支持三种不同的模式：</span>
<span class="token comment"># no：不要立刻刷，只有在操作系统需要刷的时候再刷。比较快。</span>
<span class="token comment"># always：每次写操作都立刻写入到aof文件。慢，但是最安全。</span>
<span class="token comment"># everysec：每秒写一次。折中方案。</span>
appendfsync everysec
<span class="token comment"># 如果AOF的同步策略设置成 &quot;always&quot; 或者 &quot;everysec&quot;，并且后台的存储进程（后台存储或写入AOF</span>
<span class="token comment"># 日志）会产生很多磁盘I/O开销。某些Linux的配置下会使Redis因为 fsync()系统调用而阻塞很久。</span>
<span class="token comment"># 注意，目前对这个情况还没有完美修正，甚至不同线程的 fsync() 会阻塞我们同步的write(2)调用。</span>
<span class="token comment"># 为了缓解这个问题，可以用下面这个选项。它可以在 BGSAVE 或 BGREWRITEAOF 处理时阻止主进程进行fsync()。</span>
<span class="token comment"># 这就意味着如果有子进程在进行保存操作，那么Redis就处于&quot;不可同步&quot;的状态。</span>
<span class="token comment"># 这实际上是说，在最差的情况下可能会丢掉30秒钟的日志数据。（默认Linux设定）</span>
<span class="token comment"># 如果你有延时问题把这个设置成&quot;yes&quot;，否则就保持&quot;no&quot;，这是保存持久数据的最安全的方式。</span>
no-appendfsync-on-rewrite <span class="token function">yes</span>
<span class="token comment"># 自动重写AOF文件</span>
auto-aof-rewrite-percentage <span class="token number">100</span>
auto-aof-rewrite-min-size 64mb
<span class="token comment"># AOF文件可能在尾部是不完整的（这跟system关闭有问题，尤其是mount ext4文件系统时</span>
<span class="token comment"># 没有加上data=ordered选项。只会发生在os死时，redis自己死不会不完整）。</span>
<span class="token comment"># 那redis重启时load进内存的时候就有问题了。</span>
<span class="token comment"># 发生的时候，可以选择redis启动报错，并且通知用户和写日志，或者load尽量多正常的数据。</span>
<span class="token comment"># 如果aof-load-truncated是yes，会自动发布一个log给客户端然后load（默认）。</span>
<span class="token comment"># 如果是no，用户必须手动redis-check-aof修复AOF文件才可以。</span>
<span class="token comment"># 注意，如果在读取的过程中，发现这个aof是损坏的，服务器也是会退出的，</span>
<span class="token comment"># 这个选项仅仅用于当服务器尝试读取更多的数据但又找不到相应的数据时。</span>
aof-load-truncated <span class="token function">yes</span>
<span class="token comment"># Lua 脚本的最大执行时间，毫秒为单位</span>
lua-time-limit <span class="token number">5000</span>
<span class="token comment"># Redis慢查询日志可以记录超过指定时间的查询</span>
slowlog-log-slower-than <span class="token number">10000</span>
<span class="token comment"># 这个长度没有限制。只是要主要会消耗内存。你可以通过 SLOWLOG RESET 来回收内存。</span>
slowlog-max-len <span class="token number">128</span>
<span class="token comment"># 客户端的输出缓冲区的限制，可用于强制断开那些因为某种原因从服务器读取数据的速度不够快的客户端</span>
client-output-buffer-limit normal <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span>
client-output-buffer-limit slave 256mb 64mb <span class="token number">60</span>
client-output-buffer-limit pubsub 32mb 8mb <span class="token number">60</span>
<span class="token comment"># 当一个子进程重写AOF文件时，文件每生成32M数据会被同步</span>
aof-rewrite-incremental-fsync <span class="token function">yes</span>
slaveof <span class="token number">127.0</span>.0.1 <span class="token number">6379</span> <span class="token comment"># 配置master的ip，port</span>
masterauth <span class="token number">123456</span> <span class="token comment"># 配置访问master的密码</span>
slaveof-serve-stale-data no
sentinel monitor mymaster <span class="token number">127.0</span>.0.1 <span class="token number">6379</span> <span class="token number">1</span>
daemonize <span class="token function">yes</span> <span class="token comment"># 在后台运行</span>
sentinel monitor mymaster <span class="token number">127.0</span>.0.1 <span class="token number">6379</span> <span class="token number">1</span> <span class="token comment"># 给master起一个名字mymaster，并且配置master的ip和端口</span>
sentinel auth-pass mymaster <span class="token number">123456</span> <span class="token comment"># master的密码</span>
port <span class="token number">26379</span> <span class="token comment">#另外两个配置36379,46379端口</span>
sentinel down-after-milliseconds mymaster <span class="token number">3000</span> <span class="token comment"># 3s未回复PING就认为master主观下线</span>
sentinel parallel-syncs mymaster <span class="token number">2</span>  <span class="token comment"># 执行故障转移时，最多可以有2个slave实例在同步新的master实例</span>
sentinel failover-timeout mymaster <span class="token number">100000</span> <span class="token comment"># 如果在10s内未能完成故障转移操作认为故障转移失败</span>
port <span class="token number">6379</span><span class="token comment"># 本示例6个节点端口分别为6379、6380、6381、6382、6383、6384</span>
daemonize <span class="token function">yes</span> <span class="token comment"># r后台运行</span>
pidfile /var/run/redis_6379.pid <span class="token comment"># 分别对应6379、6380、6381、6382、6383、6384</span>
cluster-enabled <span class="token function">yes</span> <span class="token comment"># 开启集群模式</span>
masterauth <span class="token number">123456</span><span class="token comment"># 如果设置了密码，需要指定master密码</span>
cluster-config-file nodes_6379.conf <span class="token comment"># 集群的配置文件，同样对应6379、6380、6381、6382、6383、6384六个节点</span>
cluster-node-timeout <span class="token number">10000</span> <span class="token comment"># 请求超时时间</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br></div></div><blockquote><p>主从模式下 conf 中没有设置 bind 会导致本机 ip 过滤,配置 0.0.0.0 即可</p> <p>主从模式下没有配置 requirepass 会导致 io 异常</p></blockquote> <h2 id="消息"><a href="#消息" class="header-anchor">#</a> 消息</h2> <table><thead><tr><th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>INFO</td> <td>获取主从最新信息,实现新节点发现</td></tr> <tr><td>PING</td> <td>封装自身节点和其他节点状态数据</td></tr> <tr><td>PONG</td> <td>当节点收到 MEET 和 PING 会回复 PONG,把自己的状态发给对方</td></tr> <tr><td>MEET</td> <td>新节点加入集群时会向老节点发送该命令</td></tr> <tr><td>FAIL</td> <td>当节点下线会向集群中广播该消息</td></tr></tbody></table> <h2 id="主从复制"><a href="#主从复制" class="header-anchor">#</a> 主从复制</h2> <h3 id="配置"><a href="#配置" class="header-anchor">#</a> 配置</h3> <ol><li>从服务器配置文件加入 slaveof</li> <li>启动命令加入<code>--slaveof</code></li> <li>客户端命令<code>slaveof</code></li> <li>断开主从关系<code>slaveof no one</code></li></ol> <h3 id="阶段"><a href="#阶段" class="header-anchor">#</a> 阶段</h3> <h4 id="全量同步"><a href="#全量同步" class="header-anchor">#</a> 全量同步</h4> <ol><li>建立连接 : <code>psync ? -1``fullsync runid offset</code></li> <li>同步 rdb 文件 : 父进程 fork 子进程生成 rdb,不阻塞接收处理客户端命令</li> <li>同步缓存区 : 缓存区记录 rdb 文件生成后接收到的写操作命令</li></ol> <h3 id="增量同步"><a href="#增量同步" class="header-anchor">#</a> 增量同步</h3> <p>当网络问题导致不一致,根据主从所保存的 offset 实现增量同步.</p> <h3 id="过程"><a href="#过程" class="header-anchor">#</a> 过程</h3> <ol><li>保存主节点信息 : masterhost、masterport 保存完后返回客户端 ok,开始异步复制</li> <li>建立连接 : 从节点每秒调用定时函数<code>replicationCron()</code>创建 socket 连接
<ul><li>从节点 : 为该 socket 建立一个专门处理复制工作的文件事件处理器,负责接收工作,接收 rdb 文件,接收命令传播</li> <li>主节点 : accept 从节点 socket 后创建客户端状态,将从节点看成客户端</li></ul></li> <li>发送 ping : 发送 ping 检查 主节点信息
<ul><li>返回 pong : 连接正常,继续复制过程</li> <li>超时 : 断开 socket , 并重连</li> <li>返回 pong 以外结果 : 主节点当前无法处理该命令,从节点断开 socket,并重连</li></ul></li> <li>身份验证 : 如果从节点中设置了 masterauth, 从节点发送 auth 命令,参数即为 masterauth 中的值,如果不一致断开连接并重连</li> <li>发送从节点端口信息 : 从节点发送监听端口,主节点保存端口信息到对应客户端的 slave_listening_port 中,主节点可以执行<code>info replication</code>查看</li> <li>数据同步 : psync,包括全量同步和增量同步,主节点检查复制缓存区的 offset
<ul><li>复制偏移量 : 主节点和从节点分别维护一个 offset,代表主节点向从节点传递的字节数</li> <li>复制积压缓存区 : 主节点维护,固定长度,默认 1M,备份主节点最近发送给从节点的数据,命令传播阶段主节点除了将写命令发送给从节点还会发送一份到该区域作为备份.<code>repl-backlog-size</code>配置该区域大小.如果 offset 偏移量之后的数据还在该区域则执行部分复制,否则全量复制</li> <li>runid : info server 可以查看 runid,如果 runid 相同校验 offset,如果不同只能进行全量复制</li></ul></li> <li>命令传播 : 该阶段除了发送写命令主从节点还维持心跳机制<code>ping</code>和<code>replconf ack</code>,命令传播为异步过程,主节点发送命令不会等待从节点回复会出现数据不一致. <code>repl-disable-tcp-nodelay no</code>配置项对包进行合并</li></ol> <h2 id="一次请求-集群"><a href="#一次请求-集群" class="header-anchor">#</a> 一次请求(集群)</h2> <h2 id="部署"><a href="#部署" class="header-anchor">#</a> 部署</h2> <h3 id="主从"><a href="#主从" class="header-anchor">#</a> 主从</h3> <h4 id="全量"><a href="#全量" class="header-anchor">#</a> 全量</h4> <ol><li>slave 发送 sync 到 master</li> <li>master 收到后执行 bgsave 生成 rdb 文件</li> <li>master 使用复制积压缓存区记录快照生成间的写命令</li> <li>master 执行完 bgsave 后向 slave 发送 rdb 快照</li> <li>slave 收到后载入快照</li> <li>master 发送缓存区命令</li> <li>slave 执行收到的缓存区命令</li></ol> <blockquote><p>2.8 版本后使用 psync 代替 sync</p></blockquote> <h4 id="增量"><a href="#增量" class="header-anchor">#</a> 增量</h4> <p>当 master 发生数据增减时出发 replicationFeedSalves 函数,master 每调用一个命令判断命令是否有数据更新,如果有且 slave 节点不为空就会执行该函数把用户执行的命令发送到 slave 节点.</p> <h3 id="哨兵"><a href="#哨兵" class="header-anchor">#</a> 哨兵</h3> <p>监控主从节点和其它哨兵,自动切换主节点,并通过发布订阅模式通知其它从节点.</p> <ol><li>sentinel 每秒向 master、slave、其它 sentinel 发送 ping</li> <li>如果一个 实例距离最后一次有效回复超过 down-after-milliseconds 则被标记为主观下线</li> <li>如果 master 被标记为主观下限,则以每秒一次的频率向其它 sentinel 确认 master 进入主观下线</li> <li>当有足够数量的 sentinel 确认,则 master 被标记为客观下线</li> <li>一般情况下 sentinel 会每 10s 的频率向 master、slave、sentinel 发送 info 命令</li> <li>当 master 标记为客观下线后,频率会升级为每秒一次</li> <li>如果没有足够数量 sentinel 同意会移除 master 客观下线状态、如果 master 重新向 sentinel 的 ping 返回有效回复,master 主观下线会被移除</li></ol> <h3 id="集群部署"><a href="#集群部署" class="header-anchor">#</a> 集群部署</h3> <h4 id="消息类型"><a href="#消息类型" class="header-anchor">#</a> 消息类型</h4> <ul><li>meet : 新节点加入,随后周期性 ping、pong 交换</li> <li>ping : 交换最频繁的消息,用于检测检点是否在线和交换彼此状态信息</li> <li>pong : 回复 meet 和 ping,封装自身状态信息,也可向集群广播 pong 消息来通知整个集群对自身状态进行更新</li> <li>fail : 当节点判断集群内另一个节点显现时会广播一个 fail 消息,其它节点收到后会把对应节点更新为下线状态</li></ul> <h3 id="故障转移"><a href="#故障转移" class="header-anchor">#</a> 故障转移</h3> <p>集群通过 ping、pong 实现故障发现,包括客观下线和主观下线,当下线主节点是,集群会统计持有槽的主节点投票,当大于一半时标记为客观下线.</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">9/12/2021, 1:59:22 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/m/Redis/缓存策略.html" class="prev">
        缓存策略
      </a></span> <span class="next"><a href="/m/deno/TypeScript.html">
        TypeScript
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/m/assets/js/app.71fdaff2.js" defer></script><script src="/m/assets/js/2.351ead77.js" defer></script><script src="/m/assets/js/41.d23cf8c8.js" defer></script>
  </body>
</html>
