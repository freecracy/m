<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL | 嗯哼人生</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    <meta name="referrer" content="no-referrer">
    
    <link rel="preload" href="/m/assets/css/0.styles.1e386fb6.css" as="style"><link rel="preload" href="/m/assets/js/app.71fdaff2.js" as="script"><link rel="preload" href="/m/assets/js/2.351ead77.js" as="script"><link rel="preload" href="/m/assets/js/5.57dbdc35.js" as="script"><link rel="prefetch" href="/m/assets/js/10.98c1e7e0.js"><link rel="prefetch" href="/m/assets/js/100.d7774ae1.js"><link rel="prefetch" href="/m/assets/js/101.0d4dea0d.js"><link rel="prefetch" href="/m/assets/js/102.6867f859.js"><link rel="prefetch" href="/m/assets/js/103.9d24bd08.js"><link rel="prefetch" href="/m/assets/js/104.4d59f256.js"><link rel="prefetch" href="/m/assets/js/105.ff49af8e.js"><link rel="prefetch" href="/m/assets/js/106.b26c7611.js"><link rel="prefetch" href="/m/assets/js/107.da5be320.js"><link rel="prefetch" href="/m/assets/js/108.0c03f842.js"><link rel="prefetch" href="/m/assets/js/109.5587de24.js"><link rel="prefetch" href="/m/assets/js/11.4e6d88d4.js"><link rel="prefetch" href="/m/assets/js/110.40ae6022.js"><link rel="prefetch" href="/m/assets/js/111.0353ccf3.js"><link rel="prefetch" href="/m/assets/js/112.f562c096.js"><link rel="prefetch" href="/m/assets/js/113.7926c003.js"><link rel="prefetch" href="/m/assets/js/114.356035f0.js"><link rel="prefetch" href="/m/assets/js/115.15e5e23e.js"><link rel="prefetch" href="/m/assets/js/116.2db2b1ed.js"><link rel="prefetch" href="/m/assets/js/117.2658e42c.js"><link rel="prefetch" href="/m/assets/js/118.037a8503.js"><link rel="prefetch" href="/m/assets/js/119.21153540.js"><link rel="prefetch" href="/m/assets/js/12.c3dadd73.js"><link rel="prefetch" href="/m/assets/js/120.b8f0644f.js"><link rel="prefetch" href="/m/assets/js/121.4c1c263a.js"><link rel="prefetch" href="/m/assets/js/122.d6ba18dd.js"><link rel="prefetch" href="/m/assets/js/123.ceef4883.js"><link rel="prefetch" href="/m/assets/js/124.9e5f50ca.js"><link rel="prefetch" href="/m/assets/js/125.de1ddc80.js"><link rel="prefetch" href="/m/assets/js/126.ae350aea.js"><link rel="prefetch" href="/m/assets/js/127.4636f6be.js"><link rel="prefetch" href="/m/assets/js/128.13b379ab.js"><link rel="prefetch" href="/m/assets/js/129.e7b0a15f.js"><link rel="prefetch" href="/m/assets/js/13.a52bd89b.js"><link rel="prefetch" href="/m/assets/js/130.147cdf11.js"><link rel="prefetch" href="/m/assets/js/131.c7a07871.js"><link rel="prefetch" href="/m/assets/js/132.faf72eb9.js"><link rel="prefetch" href="/m/assets/js/133.6301923b.js"><link rel="prefetch" href="/m/assets/js/134.4357c6e4.js"><link rel="prefetch" href="/m/assets/js/135.0ea43a3d.js"><link rel="prefetch" href="/m/assets/js/136.5a7c2377.js"><link rel="prefetch" href="/m/assets/js/137.393c998e.js"><link rel="prefetch" href="/m/assets/js/138.dcf958b6.js"><link rel="prefetch" href="/m/assets/js/139.1ccac68b.js"><link rel="prefetch" href="/m/assets/js/14.96fff293.js"><link rel="prefetch" href="/m/assets/js/140.938c314e.js"><link rel="prefetch" href="/m/assets/js/141.03cc2137.js"><link rel="prefetch" href="/m/assets/js/142.db00aba9.js"><link rel="prefetch" href="/m/assets/js/143.6d7b22af.js"><link rel="prefetch" href="/m/assets/js/144.850ed5a9.js"><link rel="prefetch" href="/m/assets/js/145.a1958a5f.js"><link rel="prefetch" href="/m/assets/js/146.1b350d4f.js"><link rel="prefetch" href="/m/assets/js/147.961f3ccd.js"><link rel="prefetch" href="/m/assets/js/148.cb4f8811.js"><link rel="prefetch" href="/m/assets/js/149.45ad7c2c.js"><link rel="prefetch" href="/m/assets/js/15.c507965f.js"><link rel="prefetch" href="/m/assets/js/150.5d952b70.js"><link rel="prefetch" href="/m/assets/js/151.5c794bb0.js"><link rel="prefetch" href="/m/assets/js/152.974e657e.js"><link rel="prefetch" href="/m/assets/js/153.b7cf98f6.js"><link rel="prefetch" href="/m/assets/js/154.be904394.js"><link rel="prefetch" href="/m/assets/js/155.769e3b0d.js"><link rel="prefetch" href="/m/assets/js/156.6107a44f.js"><link rel="prefetch" href="/m/assets/js/157.0bf74a2b.js"><link rel="prefetch" href="/m/assets/js/158.d499f907.js"><link rel="prefetch" href="/m/assets/js/159.6b2acd2c.js"><link rel="prefetch" href="/m/assets/js/16.247520d0.js"><link rel="prefetch" href="/m/assets/js/160.ec909209.js"><link rel="prefetch" href="/m/assets/js/161.4832768d.js"><link rel="prefetch" href="/m/assets/js/162.ae74834a.js"><link rel="prefetch" href="/m/assets/js/163.8af51be9.js"><link rel="prefetch" href="/m/assets/js/164.0d64a1ef.js"><link rel="prefetch" href="/m/assets/js/165.5e5a775c.js"><link rel="prefetch" href="/m/assets/js/166.121987f8.js"><link rel="prefetch" href="/m/assets/js/167.1c270942.js"><link rel="prefetch" href="/m/assets/js/168.200df8c8.js"><link rel="prefetch" href="/m/assets/js/169.84f5e0d7.js"><link rel="prefetch" href="/m/assets/js/17.3cb462b5.js"><link rel="prefetch" href="/m/assets/js/170.57b7eec5.js"><link rel="prefetch" href="/m/assets/js/171.d993d636.js"><link rel="prefetch" href="/m/assets/js/172.820d00a1.js"><link rel="prefetch" href="/m/assets/js/173.cc29ff6e.js"><link rel="prefetch" href="/m/assets/js/174.99d62af7.js"><link rel="prefetch" href="/m/assets/js/175.da874148.js"><link rel="prefetch" href="/m/assets/js/176.d0755bfc.js"><link rel="prefetch" href="/m/assets/js/177.8b00d874.js"><link rel="prefetch" href="/m/assets/js/178.2b0cfda8.js"><link rel="prefetch" href="/m/assets/js/179.780a3873.js"><link rel="prefetch" href="/m/assets/js/18.298da910.js"><link rel="prefetch" href="/m/assets/js/180.7c0ac3dc.js"><link rel="prefetch" href="/m/assets/js/181.507f9073.js"><link rel="prefetch" href="/m/assets/js/182.87f76d4a.js"><link rel="prefetch" href="/m/assets/js/183.1410502e.js"><link rel="prefetch" href="/m/assets/js/184.80666cb3.js"><link rel="prefetch" href="/m/assets/js/185.dc628b97.js"><link rel="prefetch" href="/m/assets/js/186.c2560a3f.js"><link rel="prefetch" href="/m/assets/js/187.6af43ea3.js"><link rel="prefetch" href="/m/assets/js/188.da75b50c.js"><link rel="prefetch" href="/m/assets/js/189.78dd960b.js"><link rel="prefetch" href="/m/assets/js/19.d9eabdf8.js"><link rel="prefetch" href="/m/assets/js/190.017586b9.js"><link rel="prefetch" href="/m/assets/js/191.5fa65eb7.js"><link rel="prefetch" href="/m/assets/js/192.5bb628c7.js"><link rel="prefetch" href="/m/assets/js/193.35707c80.js"><link rel="prefetch" href="/m/assets/js/194.35c3b13b.js"><link rel="prefetch" href="/m/assets/js/195.6dc8874b.js"><link rel="prefetch" href="/m/assets/js/196.01a1e825.js"><link rel="prefetch" href="/m/assets/js/197.5745084a.js"><link rel="prefetch" href="/m/assets/js/198.0455ca12.js"><link rel="prefetch" href="/m/assets/js/199.75129c13.js"><link rel="prefetch" href="/m/assets/js/20.ce14ddb9.js"><link rel="prefetch" href="/m/assets/js/200.a08681d0.js"><link rel="prefetch" href="/m/assets/js/201.a54018b7.js"><link rel="prefetch" href="/m/assets/js/202.2361e839.js"><link rel="prefetch" href="/m/assets/js/203.b92491ee.js"><link rel="prefetch" href="/m/assets/js/204.13742571.js"><link rel="prefetch" href="/m/assets/js/205.b066e447.js"><link rel="prefetch" href="/m/assets/js/206.e2c72f2c.js"><link rel="prefetch" href="/m/assets/js/207.09a83a9a.js"><link rel="prefetch" href="/m/assets/js/208.f4b8d71c.js"><link rel="prefetch" href="/m/assets/js/209.1a4e4d18.js"><link rel="prefetch" href="/m/assets/js/21.0dc0e0bf.js"><link rel="prefetch" href="/m/assets/js/210.9709d46f.js"><link rel="prefetch" href="/m/assets/js/211.3704916b.js"><link rel="prefetch" href="/m/assets/js/212.7c96c99f.js"><link rel="prefetch" href="/m/assets/js/213.b4aedaa1.js"><link rel="prefetch" href="/m/assets/js/214.d0b2586b.js"><link rel="prefetch" href="/m/assets/js/215.2268650a.js"><link rel="prefetch" href="/m/assets/js/216.dcaa6f2f.js"><link rel="prefetch" href="/m/assets/js/217.33aaf649.js"><link rel="prefetch" href="/m/assets/js/218.216d8592.js"><link rel="prefetch" href="/m/assets/js/219.44d35873.js"><link rel="prefetch" href="/m/assets/js/22.ce355d8a.js"><link rel="prefetch" href="/m/assets/js/220.ff06fa11.js"><link rel="prefetch" href="/m/assets/js/221.93379b76.js"><link rel="prefetch" href="/m/assets/js/222.6f0bbeea.js"><link rel="prefetch" href="/m/assets/js/223.4c5e29f0.js"><link rel="prefetch" href="/m/assets/js/224.e7be32e4.js"><link rel="prefetch" href="/m/assets/js/225.4915db8f.js"><link rel="prefetch" href="/m/assets/js/226.60f21d11.js"><link rel="prefetch" href="/m/assets/js/227.0e63cf34.js"><link rel="prefetch" href="/m/assets/js/228.e7b7a543.js"><link rel="prefetch" href="/m/assets/js/229.73bf392a.js"><link rel="prefetch" href="/m/assets/js/23.40c917ac.js"><link rel="prefetch" href="/m/assets/js/230.9f789c55.js"><link rel="prefetch" href="/m/assets/js/231.8fd85bc2.js"><link rel="prefetch" href="/m/assets/js/232.e6c4a62c.js"><link rel="prefetch" href="/m/assets/js/233.45636bf3.js"><link rel="prefetch" href="/m/assets/js/234.5194ce16.js"><link rel="prefetch" href="/m/assets/js/235.15ba019b.js"><link rel="prefetch" href="/m/assets/js/236.ac5768c1.js"><link rel="prefetch" href="/m/assets/js/237.91ec2e5a.js"><link rel="prefetch" href="/m/assets/js/238.af630344.js"><link rel="prefetch" href="/m/assets/js/239.b2b84093.js"><link rel="prefetch" href="/m/assets/js/24.5b681006.js"><link rel="prefetch" href="/m/assets/js/240.9c9b1fba.js"><link rel="prefetch" href="/m/assets/js/241.c26c2147.js"><link rel="prefetch" href="/m/assets/js/242.ce44f37f.js"><link rel="prefetch" href="/m/assets/js/243.aa04b829.js"><link rel="prefetch" href="/m/assets/js/244.ee4c9090.js"><link rel="prefetch" href="/m/assets/js/245.62ebda1d.js"><link rel="prefetch" href="/m/assets/js/246.2fd9ce22.js"><link rel="prefetch" href="/m/assets/js/247.52b3e746.js"><link rel="prefetch" href="/m/assets/js/248.2e432a32.js"><link rel="prefetch" href="/m/assets/js/249.4598fccb.js"><link rel="prefetch" href="/m/assets/js/25.d5d6ba55.js"><link rel="prefetch" href="/m/assets/js/250.7c93bc3e.js"><link rel="prefetch" href="/m/assets/js/251.4d402930.js"><link rel="prefetch" href="/m/assets/js/252.1b3fb775.js"><link rel="prefetch" href="/m/assets/js/253.01a9b4f8.js"><link rel="prefetch" href="/m/assets/js/254.29de4256.js"><link rel="prefetch" href="/m/assets/js/255.4911ce12.js"><link rel="prefetch" href="/m/assets/js/256.0a40f8d2.js"><link rel="prefetch" href="/m/assets/js/257.2111ae5e.js"><link rel="prefetch" href="/m/assets/js/258.0e9b2cd1.js"><link rel="prefetch" href="/m/assets/js/259.43158d35.js"><link rel="prefetch" href="/m/assets/js/26.b1e00e8a.js"><link rel="prefetch" href="/m/assets/js/260.72ea8c45.js"><link rel="prefetch" href="/m/assets/js/261.3f679643.js"><link rel="prefetch" href="/m/assets/js/262.d9ecaed6.js"><link rel="prefetch" href="/m/assets/js/27.556976c4.js"><link rel="prefetch" href="/m/assets/js/28.11027d56.js"><link rel="prefetch" href="/m/assets/js/29.f40ac6f5.js"><link rel="prefetch" href="/m/assets/js/3.a2a1a8e5.js"><link rel="prefetch" href="/m/assets/js/30.3b59bb10.js"><link rel="prefetch" href="/m/assets/js/31.c37142be.js"><link rel="prefetch" href="/m/assets/js/32.c5e0d2a0.js"><link rel="prefetch" href="/m/assets/js/33.4f5f3a8d.js"><link rel="prefetch" href="/m/assets/js/34.4a3a9398.js"><link rel="prefetch" href="/m/assets/js/35.77f89f97.js"><link rel="prefetch" href="/m/assets/js/36.6ea00d3c.js"><link rel="prefetch" href="/m/assets/js/37.b5a3b5b4.js"><link rel="prefetch" href="/m/assets/js/38.24b26621.js"><link rel="prefetch" href="/m/assets/js/39.ab372876.js"><link rel="prefetch" href="/m/assets/js/4.b9f14f77.js"><link rel="prefetch" href="/m/assets/js/40.7a81caac.js"><link rel="prefetch" href="/m/assets/js/41.d23cf8c8.js"><link rel="prefetch" href="/m/assets/js/42.ef938986.js"><link rel="prefetch" href="/m/assets/js/43.708a3cf3.js"><link rel="prefetch" href="/m/assets/js/44.f705f7de.js"><link rel="prefetch" href="/m/assets/js/45.0e6afdb6.js"><link rel="prefetch" href="/m/assets/js/46.9815c7cc.js"><link rel="prefetch" href="/m/assets/js/47.5d1c1dcc.js"><link rel="prefetch" href="/m/assets/js/48.d9d571a6.js"><link rel="prefetch" href="/m/assets/js/49.9cbaa1e9.js"><link rel="prefetch" href="/m/assets/js/50.265f94f4.js"><link rel="prefetch" href="/m/assets/js/51.094b2e7f.js"><link rel="prefetch" href="/m/assets/js/52.8b7101c0.js"><link rel="prefetch" href="/m/assets/js/53.98f3fc0b.js"><link rel="prefetch" href="/m/assets/js/54.b3d830fd.js"><link rel="prefetch" href="/m/assets/js/55.fb9cd8c7.js"><link rel="prefetch" href="/m/assets/js/56.878cf94b.js"><link rel="prefetch" href="/m/assets/js/57.1c819831.js"><link rel="prefetch" href="/m/assets/js/58.ac3faf70.js"><link rel="prefetch" href="/m/assets/js/59.b0483bf9.js"><link rel="prefetch" href="/m/assets/js/6.a0c51186.js"><link rel="prefetch" href="/m/assets/js/60.48c301e6.js"><link rel="prefetch" href="/m/assets/js/61.4bf4f2e7.js"><link rel="prefetch" href="/m/assets/js/62.d927584b.js"><link rel="prefetch" href="/m/assets/js/63.b72a48f3.js"><link rel="prefetch" href="/m/assets/js/64.6923d7c8.js"><link rel="prefetch" href="/m/assets/js/65.042fc335.js"><link rel="prefetch" href="/m/assets/js/66.1afdb278.js"><link rel="prefetch" href="/m/assets/js/67.04f7b0c7.js"><link rel="prefetch" href="/m/assets/js/68.97789db4.js"><link rel="prefetch" href="/m/assets/js/69.d914e9f8.js"><link rel="prefetch" href="/m/assets/js/7.aef5e50f.js"><link rel="prefetch" href="/m/assets/js/70.84845956.js"><link rel="prefetch" href="/m/assets/js/71.d6e9132a.js"><link rel="prefetch" href="/m/assets/js/72.2c1f5783.js"><link rel="prefetch" href="/m/assets/js/73.789e9372.js"><link rel="prefetch" href="/m/assets/js/74.e79f4842.js"><link rel="prefetch" href="/m/assets/js/75.4a389066.js"><link rel="prefetch" href="/m/assets/js/76.f5721f28.js"><link rel="prefetch" href="/m/assets/js/77.e6ce992d.js"><link rel="prefetch" href="/m/assets/js/78.5c31237a.js"><link rel="prefetch" href="/m/assets/js/79.6a4f09e0.js"><link rel="prefetch" href="/m/assets/js/8.aac4a85a.js"><link rel="prefetch" href="/m/assets/js/80.23b925ca.js"><link rel="prefetch" href="/m/assets/js/81.bc8138cb.js"><link rel="prefetch" href="/m/assets/js/82.4783bc83.js"><link rel="prefetch" href="/m/assets/js/83.1be8f057.js"><link rel="prefetch" href="/m/assets/js/84.3132660e.js"><link rel="prefetch" href="/m/assets/js/85.95c5ab8b.js"><link rel="prefetch" href="/m/assets/js/86.17c9a201.js"><link rel="prefetch" href="/m/assets/js/87.daa0da6b.js"><link rel="prefetch" href="/m/assets/js/88.9409cacc.js"><link rel="prefetch" href="/m/assets/js/89.bf04eaa0.js"><link rel="prefetch" href="/m/assets/js/9.0dd0ff11.js"><link rel="prefetch" href="/m/assets/js/90.5e1e2630.js"><link rel="prefetch" href="/m/assets/js/91.6466b581.js"><link rel="prefetch" href="/m/assets/js/92.0dd7ffc6.js"><link rel="prefetch" href="/m/assets/js/93.045047c7.js"><link rel="prefetch" href="/m/assets/js/94.ce06dedb.js"><link rel="prefetch" href="/m/assets/js/95.f673ef28.js"><link rel="prefetch" href="/m/assets/js/96.1f73d13d.js"><link rel="prefetch" href="/m/assets/js/97.b1800fdc.js"><link rel="prefetch" href="/m/assets/js/98.245eb5e4.js"><link rel="prefetch" href="/m/assets/js/99.2cfc78a1.js">
    <link rel="stylesheet" href="/m/assets/css/0.styles.1e386fb6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/m/" class="home-link router-link-active"><!----> <span class="site-name">嗯哼人生</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/m/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://cn100800.tk" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="mailto:freecracy1024@gmail.com" class="nav-link external">
  mail
  <!----></a></div><div class="nav-item"><a href="https://google.com.hk" target="_blank" rel="noopener noreferrer" class="nav-link external">
  google
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/m/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://cn100800.tk" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="mailto:freecracy1024@gmail.com" class="nav-link external">
  mail
  <!----></a></div><div class="nav-item"><a href="https://google.com.hk" target="_blank" rel="noopener noreferrer" class="nav-link external">
  google
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Go语言之旅</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Deno</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其他</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>周末闲谈</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>深度好文</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>漫步 Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>设计模式</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/m/设计模式/分库分表.html" class="sidebar-link">分库分表</a></li><li><a href="/m/设计模式/ES.html" class="sidebar-link">ES</a></li><li><a href="/m/设计模式/多账号登录.html" class="sidebar-link">多账户统一登录</a></li><li><a href="/m/设计模式/IM.html" class="sidebar-link">IM即时通信</a></li><li><a href="/m/设计模式/GraphQL.html" class="sidebar-link">GraphQL</a></li><li><a href="/m/设计模式/常用命令.html" class="sidebar-link">常用命令</a></li><li><a href="/m/设计模式/OAuth2.html" class="sidebar-link">OAuth2.0</a></li><li><a href="/m/设计模式/IO模型.html" class="sidebar-link">IO模型</a></li><li><a href="/m/设计模式/MySQL.html" class="active sidebar-link">MySQL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#常用-sql" class="sidebar-link">常用 sql</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#数据类型" class="sidebar-link">数据类型</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#常用函数" class="sidebar-link">常用函数</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#存储过程" class="sidebar-link">存储过程</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#触发器" class="sidebar-link">触发器</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#示例-sql" class="sidebar-link">示例 SQL</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#常用工具" class="sidebar-link">常用工具</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#死锁" class="sidebar-link">死锁</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#explain-结果" class="sidebar-link">explain 结果</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#profile-结果" class="sidebar-link">profile 结果</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#processlist-结果" class="sidebar-link">processlist 结果</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#join" class="sidebar-link">join</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#日志" class="sidebar-link">日志</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#b-树能存储多少数据" class="sidebar-link">B+树能存储多少数据</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#innodb-后台线程分类" class="sidebar-link">innodb 后台线程分类</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#mysql-删除重复" class="sidebar-link">mysql 删除重复</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#conf" class="sidebar-link">conf</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#函数" class="sidebar-link">函数</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#避免插入重复数据" class="sidebar-link">避免插入重复数据</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#utf8" class="sidebar-link">utf8</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#join-2" class="sidebar-link">join</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#聚合" class="sidebar-link">聚合</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#帮助" class="sidebar-link">帮助</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#配置" class="sidebar-link">配置</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#binlog" class="sidebar-link">binlog</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#drop、truncate、delete" class="sidebar-link">drop、truncate、delete</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#死锁-2" class="sidebar-link">死锁</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#为什么使用-b" class="sidebar-link">为什么使用 B+</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#hash-jion" class="sidebar-link">hash jion</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#事务" class="sidebar-link">事务</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#自增-id-耗尽" class="sidebar-link">自增 ID 耗尽</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#一次请求过程-集群" class="sidebar-link">一次请求过程(集群)</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#查找时区分大小写" class="sidebar-link">查找时区分大小写</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#主从延迟" class="sidebar-link">主从延迟</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#一条-sql-执行过程" class="sidebar-link">一条 sql 执行过程</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#binlog-redolog" class="sidebar-link">binlog &amp;&amp; redolog</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#order-by-limit" class="sidebar-link">order by &amp; limit</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#主从不一致" class="sidebar-link">主从不一致</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#主主不一致" class="sidebar-link">主主不一致</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#myisam-和-innodb-区别" class="sidebar-link">myisam 和 innodb 区别</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#锁类型" class="sidebar-link">锁类型</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#acid" class="sidebar-link">ACID</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#隔离级别" class="sidebar-link">隔离级别</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#mvcc-2" class="sidebar-link">MVCC</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#间隙锁" class="sidebar-link">间隙锁</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#分库分表" class="sidebar-link">分库分表</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#分表后唯一-id-唯一性" class="sidebar-link">分表后唯一 id 唯一性</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#主从同步" class="sidebar-link">主从同步</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#主从延迟-2" class="sidebar-link">主从延迟</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#隔离级别-2" class="sidebar-link">隔离级别</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#索引下推" class="sidebar-link">索引下推</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#空洞" class="sidebar-link">空洞</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#online-ddl" class="sidebar-link">online ddl</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#sql-执行过程" class="sidebar-link">sql 执行过程</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#count-1-count-count-字段" class="sidebar-link">count(1) &amp; count(*) &amp; count(字段)</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#日志-2" class="sidebar-link">日志</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#ip-存储" class="sidebar-link">ip 存储</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#sql-safe-updates" class="sidebar-link">sqlsafeupdates</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#innodb" class="sidebar-link">innodb</a></li><li class="sidebar-sub-header"><a href="/m/设计模式/MySQL.html#小结" class="sidebar-link">小结</a></li></ul></li><li><a href="/m/设计模式/搜索引擎.html" class="sidebar-link">搜索引擎</a></li><li><a href="/m/设计模式/feed流.html" class="sidebar-link">feed流</a></li><li><a href="/m/设计模式/PHP.html" class="sidebar-link">PHP</a></li><li><a href="/m/设计模式/Rust.html" class="sidebar-link">Rust</a></li><li><a href="/m/设计模式/WebSocket.html" class="sidebar-link">Websocket</a></li><li><a href="/m/设计模式/注册中心.html" class="sidebar-link">注册中心</a></li><li><a href="/m/设计模式/web.html" class="sidebar-link">HTTPS</a></li><li><a href="/m/设计模式/k8s.html" class="sidebar-link">k8s</a></li><li><a href="/m/设计模式/vue.html" class="sidebar-link">vue</a></li><li><a href="/m/设计模式/lua.html" class="sidebar-link">lua</a></li><li><a href="/m/设计模式/leader.html" class="sidebar-link">leader</a></li><li><a href="/m/设计模式/热门搜索字符串.html" class="sidebar-link">热门搜索字符串</a></li><li><a href="/m/设计模式/延时消息.html" class="sidebar-link">延时消息</a></li><li><a href="/m/设计模式/分布式事务.html" class="sidebar-link">分布式事务</a></li><li><a href="/m/设计模式/再谈架构.html" class="sidebar-link">再谈架构</a></li><li><a href="/m/设计模式/日志监控.html" class="sidebar-link">日志监控</a></li><li><a href="/m/设计模式/权限系统.html" class="sidebar-link">权限系统</a></li><li><a href="/m/设计模式/消息队列.html" class="sidebar-link">消息队列</a></li><li><a href="/m/设计模式/点赞签到.html" class="sidebar-link">点赞签到</a></li><li><a href="/m/设计模式/用户排名.html" class="sidebar-link">用户排名</a></li><li><a href="/m/设计模式/电商系统.html" class="sidebar-link">电商系统</a></li><li><a href="/m/设计模式/直播.html" class="sidebar-link">直播</a></li><li><a href="/m/设计模式/秒杀抢购.html" class="sidebar-link">秒杀抢购</a></li><li><a href="/m/设计模式/设计模式.html" class="sidebar-link">设计模式</a></li><li><a href="/m/设计模式/通用型系统设计.html" class="sidebar-link">通用型系统设计</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>鸡汤软文</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mysql"><a href="#mysql" class="header-anchor">#</a> MySQL</h1> <h2 id="常用-sql"><a href="#常用-sql" class="header-anchor">#</a> 常用 sql</h2> <p>information_schema : 主要存储一些数据库对象信息 : 用户表信息、权限信息、分区信息等</p> <p>performance_schema : 主要收集数据库服务器性能参数</p> <p>sys : 包含存储过程、自定义函数、视图</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> id<span class="token punctuation">,</span>name <span class="token keyword">from</span> test <span class="token keyword">pivot</span> <span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span> <span class="token keyword">for</span> quarter <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> pvt<span class="token punctuation">)</span> <span class="token comment"># 行转列 pivot</span>
<span class="token keyword">select</span> id<span class="token punctuation">,</span>name <span class="token keyword">from</span> test <span class="token keyword">unpivot</span> <span class="token punctuation">(</span>number <span class="token keyword">for</span> quarter <span class="token operator">in</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">unpivot</span> <span class="token comment"># 列转行 unpivot</span>
<span class="token keyword">select</span> <span class="token keyword">replace</span><span class="token punctuation">(</span><span class="token string">'abcde'</span><span class="token punctuation">,</span> substring<span class="token punctuation">(</span><span class="token string">'abcde'</span><span class="token punctuation">,</span> <span class="token string">'2,4'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'***'</span><span class="token punctuation">)</span> <span class="token comment"># 部分位显示* substring/replace</span>
<span class="token keyword">show</span> <span class="token keyword">engine</span> <span class="token keyword">innodb</span> <span class="token keyword">status</span> <span class="token comment"># 显示 innnodb 信息</span>
<span class="token keyword">show</span> master <span class="token keyword">status</span> <span class="token comment">/** show slave status **/</span>
<span class="token keyword">set</span> @<span class="token variable">@auto_increment_offset</span> <span class="token operator">=</span> n <span class="token comment">/** 设置初始值 **/</span>
<span class="token keyword">set</span> @<span class="token variable">@auto_increment_increment</span> <span class="token operator">=</span> n <span class="token comment">/** 设置步长 **/</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> table_name <span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span> <span class="token comment">/** 可以重建索引,delete 不会真正的删除数据所以会出现空洞 **/</span>
change master <span class="token keyword">to</span> <span class="token comment">/** 配置主从同步 **/</span>
<span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span> <span class="token comment">/** sql 注入获取数据库名 **/</span>
<span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> GROUP_CONCAT<span class="token punctuation">(</span>schema_name<span class="token punctuation">)</span> <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span>schemata<span class="token punctuation">)</span> schemaName<span class="token punctuation">,</span><span class="token number">1</span> <span class="token comment">/** sql 注入中获取用户所有库 **/</span>
mysql <span class="token comment">--help |grep options -A 1 # 查找配置文件路径</span>
<span class="token keyword">SELECT</span> @<span class="token variable">@basedir</span> <span class="token comment"># 安装目录</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="数据类型"><a href="#数据类型" class="header-anchor">#</a> 数据类型</h2> <table><thead><tr><th>类型</th> <th>字节数</th></tr></thead> <tbody><tr><td>tinyint、smallint、mediumint、int、bigint</td> <td>1、2、3、4、8 字节</td></tr> <tr><td>float、double、decimal(字符串形式存在)</td> <td>4、8、精准浮点数,计算时不会丢精度</td></tr> <tr><td>text、blob</td> <td>区分大小写、不区分大小写,会使 binlog 变大</td></tr> <tr><td>year、date、time、datetime、timestamp</td> <td>YYYY、YYYY-MM-DD、HH:MM:SS、YYY-MM-DD HH:MM:SS (8 字节)、时间戳(4 字节,有时区属性)</td></tr> <tr><td>char、varchar</td> <td>超过容量后跟 varcha r 没区别、早期是字节数,现在是字符数</td></tr> <tr><td>enum、set</td> <td></td></tr></tbody></table> <p>每个 char 占用相同数量的字符,如果插入字符少于定义的字符数量会在后面填充空格,如果插入的字符超过了定义的数量,后面超出部分会被截断.</p> <h2 id="常用函数"><a href="#常用函数" class="header-anchor">#</a> 常用函数</h2> <h2 id="存储过程"><a href="#存储过程" class="header-anchor">#</a> 存储过程</h2> <h2 id="触发器"><a href="#触发器" class="header-anchor">#</a> 触发器</h2> <h2 id="示例-sql"><a href="#示例-sql" class="header-anchor">#</a> 示例 SQL</h2> <h2 id="常用工具"><a href="#常用工具" class="header-anchor">#</a> 常用工具</h2> <h3 id="优化"><a href="#优化" class="header-anchor">#</a> 优化</h3> <table><thead><tr><th>工具</th> <th>作用</th></tr></thead> <tbody><tr><td>mysqltuner.pl</td> <td>主要检查参数是否合理</td></tr> <tr><td>tuning-primer.sh</td> <td>整体体检</td></tr> <tr><td>pt-variable-advisor</td> <td>分析 mysql 变量</td></tr> <tr><td>pt-query-digest</td> <td>分析慢日志,比 mysqldumpshow 结果更具体</td></tr></tbody></table> <h3 id="备份"><a href="#备份" class="header-anchor">#</a> 备份</h3> <table><thead><tr><th>工具</th> <th>作用</th></tr></thead> <tbody><tr><td>mysqldump</td> <td>一般备份小于 100G 的库.逻辑备份</td></tr> <tr><td>Xtranbackup</td> <td>100G 以上的库速度明显比 dump 快.无力备份,直接拷贝表空间文件.</td></tr></tbody></table> <h2 id="死锁"><a href="#死锁" class="header-anchor">#</a> 死锁</h2> <p>死锁 : 一组进程中每个进程都在等待一个事件,而这个事件只能由该组中一个进程触发</p> <ol><li>可抢占资源 : 可以从其他进程抢占而不会造成其他影响,如内存</li> <li>不可抢占资源 : 除非错误或异常,否则进程无法抢占指定资源</li> <li>虽然抢占式资源也会造成死锁,这种一般使用进程重新分配资源解决</li></ol> <h2 id="explain-结果"><a href="#explain-结果" class="header-anchor">#</a> explain 结果</h2> <p>explain 并不会真正执行,模拟优化器来执行 sql,如果 from 中包含子查询仍会执行子查询,将结果放入临时表.</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>explain extended <span class="token comment"># show warnings 可以得到优化后的查询语句</span>
explain partitions <span class="token comment"># 分析使用了分区的表,不常用</span>
explain <span class="token assign-left variable">format</span><span class="token operator">=</span>tree
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="id"><a href="#id" class="header-anchor">#</a> ID</h3> <p>查询顺序号,有几个 select 就会显示几行,顺序是按 select 出现顺序增长的, ID 列值越大执行优先级越高越先执行, ID 列相同则从上往下执行, ID 列值为 null 最后执行.</p> <h3 id="select-type"><a href="#select-type" class="header-anchor">#</a> select_type</h3> <table><thead><tr><th>select_type</th> <th>描述</th></tr></thead> <tbody><tr><td>simple</td> <td>当前行对应的 select 是简单查询不包含子查询和 union</td></tr> <tr><td>primary</td> <td>当前行对应的 select 是复杂查询中最外层的 select</td></tr> <tr><td>subquery</td> <td>当前行对应的 select 是包含在 select 的子查询</td></tr> <tr><td>derived</td> <td>当前行对应的 select 是包含在 from 子句中的子查询</td></tr> <tr><td>union</td> <td>当前行对应的 select 是在 union 中的第二个和随后的 select</td></tr> <tr><td>union result</td> <td>当前行对应的 select 是从 union 临时表检索结果的 select</td></tr></tbody></table> <h3 id="table"><a href="#table" class="header-anchor">#</a> table</h3> <p>当查询的 from 子句中有子查询时, table 列是 derivedN 格式,表示当前 select 依赖 ID = N 结果行对应的查询,要先执行 ID = N 的查询.当存在 union 时, union result 的 talbe 列值为 unionN1,N2, N1 和 N2 表示参与 union 的 select 行的 ID 序号.</p> <h3 id="type"><a href="#type" class="header-anchor">#</a> type</h3> <p>优化器决定怎么查找数据表中当数据,以及查找数据行记录的大概范围.取值表示优化程度的优劣.</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>null <span class="token operator">&gt;</span> system <span class="token operator">&gt;</span> const <span class="token operator">&gt;</span> eq_ref <span class="token operator">&gt;</span> ref <span class="token operator">&gt;</span> range <span class="token operator">&gt;</span> index <span class="token operator">&gt;</span> ALL <span class="token comment"># 一般情况下保证查询达到 range 级别,最好达到 ref</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><table><thead><tr><th>type</th> <th>描述</th></tr></thead> <tbody><tr><td>null</td> <td>优化过程中就已经可以得到结果,执行阶段就不需要访问表和索引</td></tr> <tr><td>sonst</td> <td>const 出现在主键或唯一索引查询,最多一个匹配行,读取一次</td></tr> <tr><td>system</td> <td>system 是 const 特例表中数据只有一条匹配<code>explian extended + show warnings</code></td></tr> <tr><td>eq_ref</td> <td>主键或唯一索引被 join 使用,仅次于 const 的连接类型</td></tr> <tr><td>ref</td> <td>使用普通索引或者联合唯一索引的前缀部分索引和某个值相比较可能会找到符合条件的多个数据行</td></tr> <tr><td>range</td> <td>出现在<code>in,between,&gt;,&lt;,&gt;=</code>等操作符中,使用一个索引来查询给定范围的行</td></tr> <tr><td>index</td> <td>扫描全表索引,index 是从索引表中读取的,所有字段都有索引,而 ALL 是从硬盘中读取,比 ALL 要快</td></tr> <tr><td>ALL</td> <td>全表扫描,从头到尾查找所有行,一般需要增加索引来进行查询优化</td></tr></tbody></table> <h3 id="注意"><a href="#注意" class="header-anchor">#</a> 注意</h3> <ol><li>结果只基于数据表中现有数据</li> <li>跟 mysql 版本有很大关系,不同版本优化器的优化策略不同</li></ol> <h3 id="extra"><a href="#extra" class="header-anchor">#</a> extra</h3> <p>using index : 使用覆盖索引</p> <h2 id="profile-结果"><a href="#profile-结果" class="header-anchor">#</a> profile 结果</h2> <h2 id="processlist-结果"><a href="#processlist-结果" class="header-anchor">#</a> processlist 结果</h2> <h2 id="join"><a href="#join" class="header-anchor">#</a> join</h2> <table><thead><tr><th>join</th> <th>结果</th></tr></thead> <tbody><tr><td>inner join</td> <td>select * from a inner join b on a.id = b.aid</td></tr> <tr><td>left join</td> <td>select * from a left join b on a.id = b.aid</td></tr> <tr><td>right join</td> <td>select * from a right join b on a.id = b.aid</td></tr> <tr><td>full join</td> <td>select * from a full join b on a.id = b.aid</td></tr></tbody></table> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> a <span class="token keyword">left</span> <span class="token keyword">join</span> b <span class="token keyword">on</span> a<span class="token punctuation">.</span>id <span class="token operator">=</span> b<span class="token punctuation">.</span>aid <span class="token keyword">where</span> b<span class="token punctuation">.</span>id <span class="token operator">is</span> <span class="token boolean">null</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> a <span class="token keyword">full</span> <span class="token keyword">join</span> b <span class="token keyword">on</span> a<span class="token punctuation">.</span>id <span class="token operator">=</span> b<span class="token punctuation">.</span>aid <span class="token keyword">where</span> a<span class="token punctuation">.</span>id <span class="token operator">is</span> <span class="token boolean">null</span> <span class="token operator">or</span> b<span class="token punctuation">.</span>id <span class="token operator">is</span> <span class="token boolean">null</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="日志"><a href="#日志" class="header-anchor">#</a> 日志</h2> <ol><li>错误日志 log_error</li> <li>慢查询日志 slow_query_log=1、slow_query_log_file、long_query_time(默认 10s,0 表示记录所有查询)、log_queries_not_using_indexes(没用到索引会记录)</li></ol> <table><thead><tr><th>工具</th> <th>用途</th></tr></thead> <tbody><tr><td>mysqldumpslow</td> <td>慢查询日志分析</td></tr> <tr><td>mysqlbinlog</td> <td>查看 binlog</td></tr> <tr><td>pt-query-digest</td> <td>查看绝大多数日志</td></tr></tbody></table> <h2 id="b-树能存储多少数据"><a href="#b-树能存储多少数据" class="header-anchor">#</a> B+树能存储多少数据</h2> <p>叶子节点假设一行数据大小 1K , 一页就能存下 16 条数据,非页节点 ID 为 bigint 长度为 8B, 指针大小 6B,一共 14B,一页可以存储 16K/14 (指针+主键),高度为 3 的 B+ 树能存储大约 2000w 数据.</p> <h2 id="innodb-后台线程分类"><a href="#innodb-后台线程分类" class="header-anchor">#</a> innodb 后台线程分类</h2> <ol><li>master thread : 核心线程,保证数据一致性,将缓存区数据刷新到磁盘</li> <li>io thread : 负责后台读写操作,接收到的读写请求后进行回调操作 <code>show variables like '%io_thread%'</code></li> <li>purge thread : 将页回收等操作从 master 分离出来</li> <li>page clean thread : 将脏页数据的刷新工作从 master 分离出来</li></ol> <h2 id="mysql-删除重复"><a href="#mysql-删除重复" class="header-anchor">#</a> mysql 删除重复</h2> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">delete</span> <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> <span class="token punctuation">(</span>字段<span class="token number">1</span><span class="token punctuation">,</span>字段<span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> 字段<span class="token number">1</span><span class="token punctuation">,</span>字段<span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> 字段<span class="token number">1</span><span class="token punctuation">,</span>字段<span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">group</span> <span class="token keyword">by</span> 字段<span class="token number">1</span><span class="token punctuation">,</span>字段<span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">having</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> b <span class="token punctuation">)</span> <span class="token operator">and</span> id <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> id <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">min</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">group</span> <span class="token keyword">by</span> 字段<span class="token number">1</span><span class="token punctuation">,</span>字段<span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">having</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> c <span class="token punctuation">)</span>
<span class="token comment">#解析</span>
delect form <span class="token keyword">table</span> <span class="token keyword">where</span> 字段 <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">and</span> id <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">select</span> 字段 <span class="token keyword">from</span> <span class="token keyword">table</span> b
<span class="token keyword">select</span> id <span class="token keyword">from</span> <span class="token keyword">table</span> c
<span class="token keyword">select</span> 字段 <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">group</span> 字段 <span class="token keyword">having</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span> <span class="token keyword">as</span> b
<span class="token keyword">select</span> <span class="token function">min</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">group</span> <span class="token keyword">by</span> 字段 <span class="token keyword">having</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span> <span class="token keyword">as</span> c
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="conf"><a href="#conf" class="header-anchor">#</a> conf</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>binlog-format <span class="token comment"># statement (写入sql) row (写入变更) mixed</span>
binlog-do-db <span class="token comment"># 需要同步的数据库,默认全部</span>
binlog-ignore-db <span class="token comment"># 不需要同步的数据库</span>
expire-logs-days <span class="token comment"># 日志保存的天数</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="函数"><a href="#函数" class="header-anchor">#</a> 函数</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>find_in_set<span class="token punctuation">(</span>str, strlist<span class="token punctuation">)</span> <span class="token comment"># str 要查询的字符串,strlist 以逗号分隔的字符串,用于查找 str 在 strlist 中的位置,返回 1-n 没找到返回 0 , 也可以替代 in find_in_set(id, '1,2,3')</span>
concat <span class="token comment"># 字符串拼接,默认逗号</span>
concat_ws <span class="token comment"># 可以自定义分隔符</span>
group_concat<span class="token punctuation">(</span>要连接的字段, 排序字段, 分隔符<span class="token punctuation">)</span> <span class="token comment"># 可以分组的同时把字段以特定分隔符拼接成字符串,该函数有长度限制,默认 1024 字节</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="避免插入重复数据"><a href="#避免插入重复数据" class="header-anchor">#</a> 避免插入重复数据</h2> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">ignore</span> info     <span class="token comment">/** 前提:插入的数据需要主键或唯一索引.如果数据存在忽略本次插入,如果不存在正常插入 **/</span>
onduplicate <span class="token keyword">key</span> <span class="token keyword">update</span> <span class="token comment">/** 前提:插入数据需要主键或唯一索引.如果数据存在则执行更新操作,如果不存在则直接插入 **/</span>
<span class="token keyword">replace</span> <span class="token keyword">into</span>           <span class="token comment">/** 前提:插入数据需要主键或唯一索引.如果存在则先删除再插入,如果不存在则直接插入 **/</span>
<span class="token keyword">insert</span> <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token keyword">exit</span>     <span class="token comment">/** 不需要主键或唯一索引,如果不存在则正常插入,如果存在则忽略 **/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="utf8"><a href="#utf8" class="header-anchor">#</a> utf8</h2> <p>在 mysql 中 utf8 编码只支持每个字符 3 个字节,真正的 ut8 每个字符最多 4 个字节, emoji 表情占 4 个字节. mysql 中 utf8mb4 才是真正的 utf8.</p> <h2 id="join-2"><a href="#join-2" class="header-anchor">#</a> join</h2> <p>内连接 : 筛选出两张表中都匹配的记录</p> <p>外连接 : 不仅选出匹配的记录,也会选出不匹配的记录</p> <p>左外连接 : 筛选出包含左表并且右表没有匹配的记录</p> <p>右外连接 : 筛选出包含右表记录并且左表没有匹配的记录</p> <h2 id="聚合"><a href="#聚合" class="header-anchor">#</a> 聚合</h2> <ol><li>汇总函数 : sum、count、max、min</li> <li>group by : 对分类聚合字段进行分组</li> <li>with : 表示对汇总后的记录再次汇总</li> <li>having : 表示对分类后结果再进行条件过滤</li></ol> <h2 id="帮助"><a href="#帮助" class="header-anchor">#</a> 帮助</h2> <ol><li>? content : 查询所有可供查询的分类</li> <li>? account management : 查询具体关于权限管理的命令</li> <li>? DATA types : 查询数据类型</li> <li>? varchar : varchar 的基本定义</li> <li>? show : 快速查询</li></ol> <h2 id="配置"><a href="#配置" class="header-anchor">#</a> 配置</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>max_binlog_size <span class="token comment"># 设置 binlog 文件大小,当文件达到某个值后会生成新的文件</span>
sync_binlog <span class="token comment"># 0 : 不强制刷盘,有系统判断 1 : 每次 commit 时都会将binlog 写入磁盘 N : 每 N 个事务才会写入磁盘</span>
innodb_flush_log_at_trx_commit <span class="token comment"># 写入 redo log file 的时机</span>
<span class="token comment"># 0 : 事务提交时不会将 redo log buffer 写入 os buffer,而是每秒写入 os buffer 并调用 fsync 写入 redo log buffer,每秒写入磁盘,系统崩溃丢失 1 秒的数据</span>
<span class="token comment"># 1 : 事务每次提交都会将 redo log buffer 写入 os buffer,并调用 fsync 刷到 redo log file.及时数据崩溃也不会丢失数据.因每次提价都写入磁盘 io 性能较差</span>
<span class="token comment"># 2 : 每次提交写入到 os buffer,然后每秒调用 fsync 将 os buffer 中的日志写入到 redo log file</span>
log_queries_not_using_indexes <span class="token comment"># 将没有使用到索引的 sql 记录到该文件</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="binlog"><a href="#binlog" class="header-anchor">#</a> binlog</h2> <table><thead><tr><th>格式</th> <th>描述</th> <th>优缺点</th> <th>默认</th></tr></thead> <tbody><tr><td>statment</td> <td>基于 sql 语句的复制,每一条写 sql 都会记录 binlog</td> <td>不记录行变化,热值文件小,但是某些情况下主从不一致</td> <td>5.7.7 前默认</td></tr> <tr><td>row</td> <td>基于行的复制,仅记录哪条记录被修改了</td> <td>不会出现存储过程、函数、触发器的无法调用不能正确复制</td> <td>5.7.7 后默认</td></tr> <tr><td>mixed</td> <td>混合模式,一般的复制使用 statment,无法复制的操作会使用 row</td> <td></td> <td></td></tr></tbody></table> <h2 id="drop、truncate、delete"><a href="#drop、truncate、delete" class="header-anchor">#</a> drop、truncate、delete</h2> <p>drop 直接删表,truncate 删除表中数据自增 ID 从 1 开始, delete 删除表中数据可以加 where 语句.</p> <ol><li>delete 语句是从表中删除行纪录同时作为事务纪录日志保存以便会滚. truncate 一次删除所有数据不记录日志不能恢复,不会激活触发器,delete 执行时会触发触发器.delte 删除只是标记为已删除,并不会释放磁盘空间.删除全部数据时 mysim 会立即释放磁盘空间,innodb 不会.带条件删除都不会释放空间.执行 optimize table 会释放磁盘空间.一行一行删除数据,会记录 redo 和 undo,会成大量日志占用磁盘空间.</li> <li>trancate 后表和索引空间大小会恢复初始大小,delete 不会减少存储空间.drop 语句将表占用空间全部释放</li> <li>trancate 只针对 table, delete 可以是 talbe 和 view</li></ol> <h3 id="delete"><a href="#delete" class="header-anchor">#</a> delete</h3> <h3 id="truncate"><a href="#truncate" class="header-anchor">#</a> truncate</h3> <ol><li>属于 DDL 语言,不走事务,不会触发触发器,执行后数据无法找回.</li> <li>执行后立即释放磁盘空间</li> <li>重置 auto_increment, 对于 innodb delete 整个表后重启 mysql 会重置 1,这个值是保存在内存中的</li></ol> <h3 id="drop"><a href="#drop" class="header-anchor">#</a> drop</h3> <ol><li>属于 DDL,所有数据删除</li></ol> <h2 id="死锁-2"><a href="#死锁-2" class="header-anchor">#</a> 死锁</h2> <p>两个或多个事务在同一个资源上相互占用,并请求锁定对方的资源导致恶性循环.</p> <ol><li>控制访问顺序</li> <li>同一个事务中尽可能一次锁定需要的资源</li> <li>升级锁定力度,行锁升级表锁</li></ol> <h2 id="为什么使用-b"><a href="#为什么使用-b" class="header-anchor">#</a> 为什么使用 B+</h2> <ol><li>b 数只适合随机检索,而 b+ 同时支持随机检索和顺序检索</li> <li>b+ 空间利用率高,减少 io 次数,磁盘读写代价低</li> <li>b+ 查询效率稳定, b 树靠近根节点查询时间短, b+ 树任何关键字查询必须从根节点到叶子节点</li> <li>b+ 叶子节点使用指针顺序连接在一起,只要遍历叶子节点就可以实现叶子遍历,频繁的范围查询 b 树不支持</li> <li>增删节点时 b+ 树叶子节点包含所有关键字并以有序链表存储,提高增删效率</li></ol> <h2 id="hash-jion"><a href="#hash-jion" class="header-anchor">#</a> hash jion</h2> <p>8.0 新特性</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>optimizer_switch 中 <span class="token assign-left variable">hash_join</span><span class="token operator">=</span>on <span class="token comment"># 默认 on</span>
join_buffer_size <span class="token comment"># 允许使用的内存数量,超过该值回在次盘中执行,如果无法在内存中完成,并且打开的文件数量超过系统变量 open_file_limit 的值,连接操作可能会失败</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="事务"><a href="#事务" class="header-anchor">#</a> 事务</h2> <table><thead><tr><th>特性</th> <th>实现</th></tr></thead> <tbody><tr><td>原子性</td> <td>undo log</td></tr> <tr><td>一致性</td> <td>代码</td></tr> <tr><td>隔离性</td> <td>MVCC</td></tr> <tr><td>持久性</td> <td>redo log</td></tr></tbody></table> <h3 id="mvcc"><a href="#mvcc" class="header-anchor">#</a> MVCC</h3> <p>查重创建版本小于或等于当前事务版本,删除版本为空或大于当前事务版本的行记录.</p> <h2 id="自增-id-耗尽"><a href="#自增-id-耗尽" class="header-anchor">#</a> 自增 ID 耗尽</h2> <p>一般 int unsigned 的最大是 2 的 32 次幂 -1,如果到达最大值时插入时使用的自增 ID 仍是该最大值,报主键冲突错误.此时建议升级 bigint unsigned.如果没有自增 ID,innodb 会自动创建一个不可见的、长度 6 字节的 row_id.代码实现上使用的是 bigint unsigned.如果 row_id 到达最大值,此时再 +1, row_id 低 48 位都为 0,在插入新数据时拿到的 row_id 就为 0,存在主键冲突的可能.为了避免隐患,每个表都建议定一个主键.</p> <h2 id="一次请求过程-集群"><a href="#一次请求过程-集群" class="header-anchor">#</a> 一次请求过程(集群)</h2> <h2 id="查找时区分大小写"><a href="#查找时区分大小写" class="header-anchor">#</a> 查找时区分大小写</h2> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token number">1.</span> <span class="token keyword">collate</span> utf8_bin <span class="token operator">like</span> <span class="token comment">/** 需要字符集 utf8 **/</span>
<span class="token keyword">collate</span> utf8mb4_bin <span class="token operator">like</span>
<span class="token number">2.</span> 创建字段时添加 <span class="token keyword">binary</span> <span class="token operator">like</span> 后增加 <span class="token keyword">binary</span> 即可
<span class="token number">3.</span> <span class="token keyword">where</span> 关键字后增加 <span class="token keyword">binary</span> 字段<span class="token punctuation">,</span>以二进制方式查找
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="主从延迟"><a href="#主从延迟" class="header-anchor">#</a> 主从延迟</h2> <h3 id="原因"><a href="#原因" class="header-anchor">#</a> 原因</h3> <ol><li>随机写盘 : binlog 和 relaylog 的写入都是顺序写盘,网络传输内网传输,不会有太大延迟,但是 sql 线程读取 relay log 的执行是随机写盘</li> <li>主库并发高 : 从库 sql 线程执行较慢</li> <li>锁等待 : sql 单线程遇到锁时就会等待,直到执行成功,如果某一时刻从库因为查询产生锁等待,只有当前执行完才会进行下面操作,产生主从延迟</li></ol> <h3 id="解决方法"><a href="#解决方法" class="header-anchor">#</a> 解决方法</h3> <ol><li>并行复制 : 5.6 版本后提供了并行复制,通过将 sql 线程转换成多个 work 线程来进行重放</li> <li>主库控制并发 : 多用缓存</li> <li>读主库 : 对于实时性比较高的数据直接读主库</li></ol> <h2 id="一条-sql-执行过程"><a href="#一条-sql-执行过程" class="header-anchor">#</a> 一条 sql 执行过程</h2> <ol><li><p>sql 驱动建立 tcp 连接</p></li> <li><p>数据库连接池(应用服务和 mysql 架构体系中都提供连接池) : 维护一定数量的连接数,节省不断传家与销毁造成的开销,(理论上是一个请求建立连接用完销毁)</p></li> <li><p>mysql 处理请求的线程获取请求后获取 sql 语句交给 sql 接口处理</p></li> <li><p>查询解析器 : 将 sql 接口传过来的 sql 语句进行解析,</p></li> <li><p>查询优化器 : 依据成本最小原则选择对应的索引(io 成本和 cpu 成本),优化器选出最优索引后调用存储引擎接口,执行被解析和优化过的 sql 语句</p> <ol><li>io 成本 : 将数据加载到内存的成本</li> <li>cpu 成本 : 将数据读取到内存后,检测数据是否满足条件和排序等操作</li></ol></li> <li><p>执行器 : 执行器根据执行计划调用存储引擎接口去完成 sql 执行,真正执行 sql 动作是在存储引擎中完成的</p></li> <li><p>buffer pool (区别 redo log buffer) : sql 语句对应的数据要么在内存要么在磁盘,如果在磁盘执行效率慢,所以 innodb 引入 buffer pool</p></li> <li><p>mysql 会先去 buffer pool 中查找数据,没找到会去磁盘中找,找到后将数据加载到 buffer pool,同时将数据原始记录保存到 undo log 中</p></li> <li><p>innodb 会在 buffer pool 中执行更新操作,更新后的数据会记录在 redo log buffer 中</p></li> <li><p>事务提交 : 将 redo log buffer 中的数据持久化到磁盘, 即将 redo log buffer 中数据写入 redo log.(一般情况下立即写入磁盘<code>innodb_flush_log_at_trx_commit</code>)</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>innodb_flush_log_at_trx_commit <span class="token comment"># 0 不刷入磁盘 1 立即刷入磁盘 2 先刷到 os cache</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>binlog : <code>sync_bin_log</code>,0 表示先写入 os cache,提价事务时数据不会立即写入磁盘, 1 表示直接写入磁盘文件</p></li> <li><p>mysql 在提交事务的时候完成以下三个动作才表示本次事务被成功提交了</p> <ol><li>将 redo log buffer 写入到 redo log 文件</li> <li>同时将本次修改数据写入到 binlog</li> <li>同时将本次修改的 binlog 文件名和内容在文件中的位置记录到 redo log 中,最后还会在 redo log 中写入 commit 标记</li></ol></li> <li><p>后台线程 : 将 buffer pool 中的数据刷入到磁盘</p></li></ol> <h2 id="binlog-redolog"><a href="#binlog-redolog" class="header-anchor">#</a> binlog &amp;&amp; redolog</h2> <ol><li>文件大小 : redo log 配置固定大小, bin log 通过配置 max_bin、log_size 设置</li> <li>实现方式 : redo log innodb 引擎实现, bin log mysql 层实现</li> <li>记录方式 : redo log 采用循环写入方式记录,回到结尾时会回到开头循环写, bin log 追加到达到固定值后生成新文件</li> <li>使用场景 : redo log 适用崩溃恢复, bin log 适用主从复制和数据恢复</li></ol> <h2 id="order-by-limit"><a href="#order-by-limit" class="header-anchor">#</a> order by &amp; limit</h2> <p>当 order by 和 limit 同时使用时 order by 有相同的列值时会随机返回,要想保证返回顺序需要 order by 增加随机列,可以保证返回的顺序.</p> <p>dao: 像访问对象一样访问数据</p> <p>orm: 简化数据查询过程</p> <h2 id="主从不一致"><a href="#主从不一致" class="header-anchor">#</a> 主从不一致</h2> <ol><li>忽略</li> <li>强制读主</li> <li>借助缓存,选择读主</li></ol> <h2 id="主主不一致"><a href="#主主不一致" class="header-anchor">#</a> 主主不一致</h2> <ol><li>不同初始值,相同步长</li> <li>应用层生成 ID</li></ol> <h2 id="myisam-和-innodb-区别"><a href="#myisam-和-innodb-区别" class="header-anchor">#</a> myisam 和 innodb 区别</h2> <ol><li>myisam : 不支持事务、行锁、外键,一般用于大量查询少量插入场景,索引和数据分开存储</li> <li>innodb: 基于聚蔟索引建立,支持事务、行锁、外键,通过 MVCC 来支持高并发,索引和数据存储在一起</li></ol> <blockquote><p>聚蔟索引 : 节点只包含 id 索引,叶子节点包含索引和数据,这种索引和数据一起存储的方式就是聚蔟索引.</p></blockquote> <p>要确定一个查询是否是覆盖索引只需要 explain 语句看 extra 结果是否是 using index.</p> <h2 id="锁类型"><a href="#锁类型" class="header-anchor">#</a> 锁类型</h2> <p>分为共享锁和排它锁,也叫读锁和写锁.读锁是共享的,通过 lock in share mode 实现,只能读不能写.写锁是排它的,会阻塞其它的写锁和读锁.</p> <p>从颗粒读来说分表锁和航锁.表锁会锁定整张表,阻塞其它用户对该表的所有读写操作,alter 修改表结构时会锁表.行锁又分乐观锁和悲观锁,悲观锁可以通过 for update 实现,乐观锁则通过版本号实现.</p> <h2 id="acid"><a href="#acid" class="header-anchor">#</a> ACID</h2> <ol><li>原子性 : 一个事务中所有操作要么全部成功,要么全部失败,通过 undo log 日志保证,记录了要会滚数据的日志信息,事务回滚时撤销已经执行成功的 sql</li> <li>一致性 : 总是从一个一致状态转换到另一个一致状态,代码层保证</li> <li>隔离性 : 一个事务的修改在最终提交前对其它事务是不可见的, MVCC 来保证隔离性</li> <li>持久性 : 一个事务一旦提交,所有修改就会永久保存到数据库中, 内存 + redo log 来保证,修改数据的同时在内存和 redo log 中记录这次操作,事务提交时通过 redo log 刷盘,宕机时从 redo log 恢复</li></ol> <h2 id="隔离级别"><a href="#隔离级别" class="header-anchor">#</a> 隔离级别</h2> <ol><li>读未提交 : 可能会读到其它事务未提交数据,即脏读</li> <li>读已提交 : 两次读取结果不一致,即不可重复读</li> <li>重复读 : 默认级别,每次读取结果不一样,但是可能产生幻读</li> <li>串行化 : 一般不会使用,会给每一行读取的数据加锁会导致大量超时和锁竞争</li></ol> <h2 id="mvcc-2"><a href="#mvcc-2" class="header-anchor">#</a> MVCC</h2> <ul><li>trx_id : 事务 id</li> <li>roll_pointer : 指向 undo_log 中上一个版本的指针</li></ul> <p>多版本并发控制,保存数据在某个时间节点的快照.实际上每行数据包含隐藏的两列,创建时间版本号和过期(删除)时间版本号,每开启一个新的事务版本号都会自动递增.MVCC 原理是查找创建版本小于或等于当前事务版本,删除版本为空或大于当前事务版本的数据.</p> <h3 id="readview"><a href="#readview" class="header-anchor">#</a> ReadView</h3> <ul><li>m_ids : 还没有提交的事务 id</li> <li>min_trx_id : m_ids 中最小的</li> <li>max_trx_id : 下一个要生成的事务 id</li> <li>creator_trx_id : 生成该 ReadView 的事务 idx</li></ul> <p>比较:</p> <ul><li>一个事务职能读取到事务 id 小于自己的数据</li> <li>RC 隔离级别下,一个事务每次发起查询都会生成一个 ReadView</li> <li>RR 隔离级别下,ReadView 只会生成一次</li></ul> <h2 id="间隙锁"><a href="#间隙锁" class="header-anchor">#</a> 间隙锁</h2> <p>是可重复读级别下才会有的锁,结合 MVCC 和间隙锁可以解决幻读问题.唯一索引是不会有间隙索引的.mysql 会自动生成区间(左开右闭)</p> <h2 id="分库分表"><a href="#分库分表" class="header-anchor">#</a> 分库分表</h2> <ol><li>垂直分库 : 微服务拆分,做到垂直拆分</li> <li>垂直分表 : 表字段过多,将不常用,数据大的做拆分.如订单</li></ol> <h2 id="分表后唯一-id-唯一性"><a href="#分表后唯一-id-唯一性" class="header-anchor">#</a> 分表后唯一 id 唯一性</h2> <ol><li>设定步长</li> <li>分布式 ID</li> <li>不使用主键,比如订单号</li></ol> <h2 id="主从同步"><a href="#主从同步" class="header-anchor">#</a> 主从同步</h2> <p>默认复制方式是异步的,主库把日志发送给从库后不关心从库是否已经处理,假设主库挂了,从库处理失败了,这时从库升级为主库,日志就丢了.</p> <p><img src="/m/assets/img/mysql-master-slave.db674b1b.png" alt="mysql主从同步"></p> <h3 id="全同步复制"><a href="#全同步复制" class="header-anchor">#</a> 全同步复制</h3> <p>主库写 binlog 后强制同步日志到从库,所有的从库都执行完成后返回给客户端,显然会影响性能.</p> <h3 id="半同步复制"><a href="#半同步复制" class="header-anchor">#</a> 半同步复制</h3> <p>从库写入 binlog 成功后返回 ack 给主库,主库收到至少一个从库的确认就认为写操作成功.</p> <h3 id="组复制"><a href="#组复制" class="header-anchor">#</a> 组复制</h3> <p>mgr : mysql group replication</p> <ol><li>分组内的成员对等关系,每个节点都可以写入</li> <li>增加了一个协商共识的认证环节,多数节点达成一致事务才能提交</li></ol> <h2 id="主从延迟-2"><a href="#主从延迟-2" class="header-anchor">#</a> 主从延迟</h2> <ol><li>特定业务场景读写请求强制主库</li> <li>读请求走从库,如果没有数据,去主库做二次查询</li></ol> <h2 id="隔离级别-2"><a href="#隔离级别-2" class="header-anchor">#</a> 隔离级别</h2> <ol><li>读未提交 : select 不加锁,可能出现脏读</li> <li>读已提交 : 普通 select 快照读(即 MVCC),select(in share mode、for update)/update/delete 会使用记录锁(使用了唯一索引)可能出现不可重复读</li> <li>可重复读 : 普通 select 快照读(即 MVCC),select(in share mode、for update)/update/delete 根据查询条件会选择记录锁(使用了唯一索引),或者间隙锁和临键锁(范围查询),防止幻读</li> <li>串行化 : select 隐式转化为 select ... in share mode,会和 update、delete 互斥</li></ol> <h2 id="索引下推"><a href="#索引下推" class="header-anchor">#</a> 索引下推</h2> <p>只有符合条件的才进行回表,对索引中包含的字段先进行判断,不符合条件的跳过,减少不必要的回表操作.先过滤掉不符合条件的再去回表而不是所有的都回表后再比较.</p> <h2 id="空洞"><a href="#空洞" class="header-anchor">#</a> 空洞</h2> <p>delete 命令只是把数据页或记录位置标记为可复用,表空间并没有回收,该现象称之为空洞.如果插入的数据是随机的非主键有序可能造成数据页分裂.如果插入按照索引递增顺序插入,索引是紧凑的不会出现数据页分裂.如果修改的是非索引值不会影响 b+树结构,如果修改的内容包含索引,是先删除一个旧值,再插入一个新值,可能会造成空洞.</p> <h2 id="online-ddl"><a href="#online-ddl" class="header-anchor">#</a> online ddl</h2> <ol><li>新建临时文件</li> <li>扫描表主键的所有数据页生成 B+ 树,存储到临时文件</li> <li>在生成临时文件过程中如果有对表做写操作,操作会记录到一个日志文件中</li> <li>当临时文件生成后,重放日志文件将操作应用到日志文件</li> <li>用临时文件替换表的数据文件</li> <li>删除旧表数据文件</li></ol> <blockquote><p>与新建表区别 : 增加了日志文件记录和重放功能,迁移过程中允许对表进行增删改操作.</p></blockquote> <h2 id="sql-执行过程"><a href="#sql-执行过程" class="header-anchor">#</a> sql 执行过程</h2> <p><img src="/m/assets/img/mysql-zhixingguocheng.86b99d4d.png" alt="mysql-zhixingguocheng"></p> <p>一张表最多可以创建 64 个非聚蔟索引,创建非聚蔟索引的列不能超过 16 个.</p> <h2 id="count-1-count-count-字段"><a href="#count-1-count-count-字段" class="header-anchor">#</a> count(1) &amp; count(*) &amp; count(字段)</h2> <ul><li>count(1) 会统计所有记录,count(字段) 不统计为 null 的记录,空字符串和 0 还会统计</li> <li>count(*) 相当于行数,会自动选择索引,不会忽略为 null 的值</li> <li>count(1) 忽略所有列,用 1 代表行,走聚集索引</li></ul> <h2 id="日志-2"><a href="#日志-2" class="header-anchor">#</a> 日志</h2> <ol><li>binlog : server 层日志</li> <li>redo log、undo log : 存储层日志</li> <li>slow_query_log : 慢查询日志</li></ol> <h3 id="主从同步策略"><a href="#主从同步策略" class="header-anchor">#</a> 主从同步策略</h3> <ul><li>同步 : master 会等所有 slave 都回应后才提交</li> <li>半同步 : 至少一个 slave 回应就提交</li> <li>异步 : 不等 slave 回应就提交</li> <li>延迟 : slave 要落后于 master 指定的时间</li></ul> <h2 id="ip-存储"><a href="#ip-存储" class="header-anchor">#</a> ip 存储</h2> <p>当存储 ipv4 时使用 32 位无符号整数,而不是字符串.ipv6 使用 varbinary.</p> <ul><li>ipv4 相关函数 : <code>INET_ATON</code>、<code>INET_NTOA</code></li> <li>ipv6 相关函数 : <code>INET6_ATON</code>、<code>INET6_NTOA</code></li></ul> <h2 id="sql-safe-updates"><a href="#sql-safe-updates" class="header-anchor">#</a> sql_safe_updates</h2> <p>innodb 如果不走索引,全表扫描会锁全表,即全表加 next-lock.可以预防 update 中 where 没有索引锁全表.如果可能会被优化器选择全表可以使用 force index.</p> <p>设置 sql_safe_updates = 1</p> <p>update 必须满足如下条件之一才能执行成功.</p> <ul><li>使用 where,并且 where 条件中必须有索引列</li> <li>使用 limit</li> <li>同时使用 where 和 limit,where 中可以没有索引列</li></ul> <p>delete 必须满足如下条件之一才能执行成功.</p> <ul><li>使用 where,并且 where 中必须有索引列</li> <li>同时使用 where 和 limit ,where 可以没有索引列</li></ul> <h2 id="innodb"><a href="#innodb" class="header-anchor">#</a> innodb</h2> <p><img src="/m/assets/img/innodb-b+shu.f60e1722.png" alt="innodb B+树"> <img src="image/innodb-yemulu.png" alt="innodb 页目录"> <img src="/m/assets/img/innodb-ye-1.865b4ce1.png" alt="innodb 页"> <img src="/m/assets/img/innodb-ye-2.a346073b.png" alt="innodb 页"> <img src="/m/assets/img/innodb-ye-3.623de80a.png" alt="innodb 页"></p> <h2 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h2> <ul><li>mysiam 可以没有主键 : 主键索引和普通索引没区别,innodb 需要主键索引所以有主键,row_id.</li> <li>数据库的 io 操作最小单位是页,innodb 数据默认大小 16k</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">3/9/2022, 11:25:09 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/m/设计模式/IO模型.html" class="prev">
        IO模型
      </a></span> <span class="next"><a href="/m/设计模式/搜索引擎.html">
        搜索引擎
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/m/assets/js/app.71fdaff2.js" defer></script><script src="/m/assets/js/2.351ead77.js" defer></script><script src="/m/assets/js/5.57dbdc35.js" defer></script>
  </body>
</html>
